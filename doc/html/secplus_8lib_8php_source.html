<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SecPlus-PHP Web Framework: secplus.lib.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SecPlus-PHP Web Framework&#160;<span id="projectnumber">1.0</span></div>
   <div id="projectbrief">MVC-PHP Web Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('secplus_8lib_8php.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">secplus.lib.php</div>  </div>
</div>
<div class="contents">
<a href="secplus_8lib_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00017"></a><a class="code" href="namespace_sec_plus.html">00017</a> <span class="keyword">namespace </span>SecPlus;
<a name="l00018"></a>00018 
<a name="l00026"></a><a class="code" href="class_sec_plus_1_1_config.html">00026</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_config.html">Config</a> {
<a name="l00027"></a>00027 
<a name="l00028"></a>00028   <span class="comment">/* Overload this constant and set the project name */</span>
<a name="l00029"></a><a class="code" href="class_sec_plus_1_1_config.html#ae4ca0cededce7cacacca1c007b51ff29">00029</a>   <span class="keyword">const</span> PROJECT_NAME = <span class="stringliteral">&quot;Sec+ WebFramework&quot;</span>;
<a name="l00030"></a>00030   
<a name="l00031"></a><a class="code" href="class_sec_plus_1_1_config.html#a80cb73e4bb4dd2a7d04b7303faf15852">00031</a>   <span class="keyword">const</span> ENV_PRODUCTION = 0;
<a name="l00032"></a><a class="code" href="class_sec_plus_1_1_config.html#abe4546334d26d358d84c5c068023a59f">00032</a>   <span class="keyword">const</span> ENV_DEVELOPMENT = 1;
<a name="l00033"></a>00033 
<a name="l00038"></a>00038   <span class="keyword">private</span> <span class="keyword">static</span> $instance;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040   <span class="keyword">private</span> $environment = Config::ENV_DEVELOPMENT;
<a name="l00041"></a>00041 
<a name="l00052"></a><a class="code" href="class_sec_plus_1_1_config.html#ad0ddb2725e69c88a729e0cc242a1b2a6">00052</a>   <span class="keyword">protected</span> $dbHost = <span class="stringliteral">&quot;127.0.0.1&quot;</span>;
<a name="l00053"></a>00053 
<a name="l00058"></a><a class="code" href="class_sec_plus_1_1_config.html#a4a92606de85aafdc0dcae4976b7ca669">00058</a>   <span class="keyword">protected</span> $dbUser = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00059"></a>00059 
<a name="l00064"></a><a class="code" href="class_sec_plus_1_1_config.html#a30d808caf55f524798c6a5aaafd633ad">00064</a>   <span class="keyword">protected</span> $dbPass = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00065"></a>00065 
<a name="l00070"></a><a class="code" href="class_sec_plus_1_1_config.html#afab8c86a322f139eb79e33a312ea64b5">00070</a>   <span class="keyword">protected</span> $dbms = <span class="stringliteral">&quot;mysql&quot;</span>;
<a name="l00071"></a>00071 
<a name="l00076"></a><a class="code" href="class_sec_plus_1_1_config.html#a00d9dc02081f2b17c0dae80bf86fea99">00076</a>   <span class="keyword">protected</span> $dbDatabase = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00077"></a>00077 
<a name="l00082"></a><a class="code" href="class_sec_plus_1_1_config.html#adc4dc6ee2d56ad844a1ccd6be7cd5af5">00082</a>   <span class="keyword">protected</span> $salt = <span class="stringliteral">&quot;Welcome, to the desert of the real&quot;</span>;
<a name="l00083"></a>00083   
<a name="l00087"></a><a class="code" href="class_sec_plus_1_1_config.html#a95fa44cd6d4c68d1925ad70e41c0dd74">00087</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_config.html#a95fa44cd6d4c68d1925ad70e41c0dd74">$rootProjectDir</a>;
<a name="l00088"></a><a class="code" href="class_sec_plus_1_1_config.html#a662682afa081c488ee7d6b2de6bd2f6c">00088</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_config.html#a662682afa081c488ee7d6b2de6bd2f6c">$libDir</a>;
<a name="l00089"></a><a class="code" href="class_sec_plus_1_1_config.html#a3c641dd8bef8033ed0ff088f937e136c">00089</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_config.html#a3c641dd8bef8033ed0ff088f937e136c">$controllerDir</a>;
<a name="l00090"></a><a class="code" href="class_sec_plus_1_1_config.html#a0a45e14f2c297b0c0e8f956085385548">00090</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_config.html#a0a45e14f2c297b0c0e8f956085385548">$modelDir</a>;
<a name="l00091"></a><a class="code" href="class_sec_plus_1_1_config.html#a5430f8a675b729372fc0109059692046">00091</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_config.html#a5430f8a675b729372fc0109059692046">$daoDir</a>;
<a name="l00092"></a><a class="code" href="class_sec_plus_1_1_config.html#a0e8d14506ce531421f71a921636e349f">00092</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_config.html#a0e8d14506ce531421f71a921636e349f">$voDir</a>;
<a name="l00093"></a><a class="code" href="class_sec_plus_1_1_config.html#a004b9a4e7f26647a02a1a2ec1eb4551a">00093</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_config.html#a004b9a4e7f26647a02a1a2ec1eb4551a">$viewDir</a>;
<a name="l00094"></a><a class="code" href="class_sec_plus_1_1_config.html#a1531855c2cd3af70bc5447db3974d7d7">00094</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_config.html#a1531855c2cd3af70bc5447db3974d7d7">$staticDir</a>;
<a name="l00095"></a>00095 
<a name="l00101"></a><a class="code" href="class_sec_plus_1_1_config.html#a0bc64f3b8da4ca7ce528a3d92894fda5">00101</a>   <span class="keyword">protected</span> $safeFiles = array();
<a name="l00102"></a>00102 
<a name="l00108"></a><a class="code" href="class_sec_plus_1_1_config.html#a97f8a8348db15caa1795c40f12f75847">00108</a>   <span class="keyword">protected</span> $safeProperties = array(
<a name="l00109"></a>00109                                     <span class="stringliteral">&#39;rootProjectDir&#39;</span>,<span class="stringliteral">&#39;libDir&#39;</span>,<span class="stringliteral">&#39;controllerDir&#39;</span>,
<a name="l00110"></a>00110                                     <span class="stringliteral">&#39;modelDir&#39;</span>,<span class="stringliteral">&#39;daoDir&#39;</span>,<span class="stringliteral">&#39;voDir&#39;</span>,<span class="stringliteral">&#39;viewDir&#39;</span>,<span class="stringliteral">&#39;staticDir&#39;</span>,
<a name="l00111"></a>00111                                     <span class="stringliteral">&#39;dbHost&#39;</span>,<span class="stringliteral">&#39;dbUser&#39;</span>,<span class="stringliteral">&#39;dbPass&#39;</span>,<span class="stringliteral">&#39;dbDatabase&#39;</span>,<span class="stringliteral">&#39;dbms&#39;</span>,
<a name="l00112"></a>00112                                     <span class="stringliteral">&#39;salt&#39;</span>,<span class="stringliteral">&#39;controllerName&#39;</span>,<span class="stringliteral">&#39;actionName&#39;</span>,<span class="stringliteral">&#39;safeFiles&#39;</span>,
<a name="l00113"></a>00113                                     <span class="stringliteral">&#39;defaultController&#39;</span>, <span class="stringliteral">&#39;defaultAction&#39;</span>, <span class="stringliteral">&#39;defaultTitle&#39;</span>
<a name="l00114"></a>00114                                     );
<a name="l00115"></a>00115 
<a name="l00121"></a><a class="code" href="class_sec_plus_1_1_config.html#a3fcaeb229c94173ba904952898e7bfed">00121</a>   <span class="keyword">protected</span> $defaultController = <span class="stringliteral">&quot;home&quot;</span>;
<a name="l00122"></a>00122 
<a name="l00128"></a><a class="code" href="class_sec_plus_1_1_config.html#ab8b5213f191f4e05bec89f1841a35c16">00128</a>   <span class="keyword">protected</span> $defaultAction = <span class="stringliteral">&quot;view&quot;</span>;
<a name="l00129"></a>00129 
<a name="l00140"></a><a class="code" href="class_sec_plus_1_1_config.html#a4845baceacf6ec5e204c54d91caa2f25">00140</a>   <span class="keyword">protected</span> $controllerName = <span class="stringliteral">&quot;controller&quot;</span>;
<a name="l00141"></a>00141 
<a name="l00146"></a><a class="code" href="class_sec_plus_1_1_config.html#a54cdc91e1800afebce650baa181b5fb9">00146</a>   <span class="keyword">protected</span> $actionName = <span class="stringliteral">&quot;action&quot;</span>;
<a name="l00147"></a>00147 
<a name="l00152"></a><a class="code" href="class_sec_plus_1_1_config.html#a180d1e674404fdbb273b10ffce61d7fb">00152</a>   <span class="keyword">protected</span> $defaultTitle = <span class="stringliteral">&quot;SEC+ Security Architecture for Enterprises&quot;</span>;
<a name="l00153"></a>00153 
<a name="l00158"></a><a class="code" href="class_sec_plus_1_1_config.html#ac93fbec81f07e5d15f80db907e63dc10">00158</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_config.html#ac93fbec81f07e5d15f80db907e63dc10">getInstance</a>() {
<a name="l00159"></a>00159     <span class="keywordflow">if</span> (isset(self::$instance))
<a name="l00160"></a>00160       <span class="keywordflow">return</span> self::$instance;
<a name="l00161"></a>00161     <span class="keywordflow">else</span> {
<a name="l00162"></a>00162       $c = get_called_class();
<a name="l00163"></a>00163       self::$instance = <span class="keyword">new</span> $c();
<a name="l00164"></a>00164       <span class="keywordflow">return</span> self::$instance;
<a name="l00165"></a>00165     }
<a name="l00166"></a>00166   }
<a name="l00167"></a>00167 
<a name="l00179"></a><a class="code" href="class_sec_plus_1_1_config.html#a095c5d389db211932136b53f25f39685">00179</a>   <span class="keyword">protected</span> function <a class="code" href="class_sec_plus_1_1_config.html#a095c5d389db211932136b53f25f39685">__construct</a>() {
<a name="l00180"></a>00180     $this-&gt;rootProjectDir = basename($_SERVER[<span class="stringliteral">&#39;SCRIPT_FILENAME&#39;</span>]) == <span class="stringliteral">&#39;index.php&#39;</span> ? dirname($_SERVER[<span class="stringliteral">&#39;SCRIPT_FILENAME&#39;</span>]) : <span class="charliteral">&#39;.&#39;</span>;
<a name="l00181"></a>00181     $this-&gt;libDir = $this-&gt;rootProjectDir . <span class="stringliteral">&#39;/lib&#39;</span>;
<a name="l00182"></a>00182     $this-&gt;controllerDir = $this-&gt;rootProjectDir . <span class="stringliteral">&#39;/controller&#39;</span>;
<a name="l00183"></a>00183     $this-&gt;modelDir = $this-&gt;rootProjectDir . <span class="stringliteral">&#39;/model&#39;</span>;
<a name="l00184"></a>00184     $this-&gt;daoDir = $this-&gt;modelDir . <span class="stringliteral">&#39;/dao&#39;</span>;
<a name="l00185"></a>00185     $this-&gt;voDir = $this-&gt;modelDir . <span class="stringliteral">&#39;/vo&#39;</span>;
<a name="l00186"></a>00186     $this-&gt;viewDir = $this-&gt;rootProjectDir . <span class="stringliteral">&#39;/view&#39;</span>;
<a name="l00187"></a>00187     $this-&gt;staticDir = $this-&gt;getProjectUrl() . <span class="stringliteral">&#39;/view&#39;</span>;
<a name="l00188"></a>00188   }
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="class_sec_plus_1_1_config.html#abacc22b77b423912f8bd5ab05432ff80">00190</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_config.html#abacc22b77b423912f8bd5ab05432ff80">setEnvironment</a>($env) { $this-&gt;environment = $env; }
<a name="l00191"></a><a class="code" href="class_sec_plus_1_1_config.html#a1a945689f9a90f9029d671ec32262d37">00191</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_config.html#a1a945689f9a90f9029d671ec32262d37">getEnvironment</a>() { <span class="keywordflow">return</span> $this-&gt;environment; }
<a name="l00192"></a><a class="code" href="class_sec_plus_1_1_config.html#a017d21b4d0e1ee6f9cdd9d805793f076">00192</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_config.html#a017d21b4d0e1ee6f9cdd9d805793f076">isDebug</a>() { <span class="keywordflow">return</span> $this-&gt;getEnvironment() == Config::ENV_DEVELOPMENT; }
<a name="l00193"></a><a class="code" href="class_sec_plus_1_1_config.html#a224bbe52d89fa2b81245d9fa451e4294">00193</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_config.html#a224bbe52d89fa2b81245d9fa451e4294">getHost</a>() { <span class="keywordflow">return</span> php_sapi_name() == <span class="stringliteral">&#39;cli&#39;</span> ? <span class="stringliteral">&#39;cli&#39;</span> : $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>]; }
<a name="l00194"></a><a class="code" href="class_sec_plus_1_1_config.html#aecfa0050ed3f04e0b3434f29ac3af88e">00194</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_config.html#aecfa0050ed3f04e0b3434f29ac3af88e">getProjectUrl</a>() { <span class="keywordflow">return</span> <span class="stringliteral">&quot;http://&quot;</span> . self::getHost() . $_SERVER[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>]; }
<a name="l00195"></a><a class="code" href="class_sec_plus_1_1_config.html#a92dca6d4e08b6f26d0c15d8df7516a68">00195</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_config.html#a92dca6d4e08b6f26d0c15d8df7516a68">getProjectBaseUrl</a>() { <span class="keywordflow">return</span> <span class="stringliteral">&quot;http://&quot;</span> . self::getHost() . dirname($_SERVER[<span class="stringliteral">&#39;SCRIPT_NAME&#39;</span>]); }
<a name="l00196"></a>00196   
<a name="l00204"></a><a class="code" href="class_sec_plus_1_1_config.html#addda52da3f818413b045c9dc45409b7c">00204</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_config.html#addda52da3f818413b045c9dc45409b7c">__call</a>($func, $args) {
<a name="l00205"></a>00205     <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^get/&#39;</span>, $func) &amp;&amp; count($args) == 0) {
<a name="l00206"></a>00206       $prop = lcfirst(substr($func, 3));
<a name="l00207"></a>00207       <span class="keywordflow">if</span> (!empty($prop) &amp;&amp; in_array($prop, $this-&gt;safeProperties)) {
<a name="l00208"></a>00208         <span class="keywordflow">return</span> $this-&gt;{$prop};
<a name="l00209"></a>00209       }
<a name="l00210"></a>00210     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^set/&#39;</span>, $func) &amp;&amp; count($args) == 1) {
<a name="l00211"></a>00211       $prop = lcfirst(substr($func, 3));
<a name="l00212"></a>00212       <span class="keywordflow">if</span> (in_array($prop, $this-&gt;safeProperties)) {
<a name="l00213"></a>00213         $this-&gt;{$prop} = $args[0];
<a name="l00214"></a>00214         <span class="keywordflow">return</span>;
<a name="l00215"></a>00215       }
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218     <span class="keywordflow">if</span> ($this-&gt;environment == Config::ENV_DEVELOPMENT) {
<a name="l00219"></a>00219       <span class="keywordflow">throw</span> <span class="keyword">new</span> \Exception(<span class="stringliteral">&quot;Fatal error: Method &#39;&quot;</span> . htmlentities($func) . <span class="stringliteral">&quot;&#39; not found or permission denied to be called.&quot;</span>);
<a name="l00220"></a>00220     } <span class="keywordflow">else</span> {
<a name="l00221"></a>00221       <span class="comment">/* blind error */</span>
<a name="l00222"></a>00222       <span class="keywordflow">throw</span> <span class="keyword">new</span> \Exception(<span class="stringliteral">&quot;Fatal error!&quot;</span>);
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224   }
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00230"></a><a class="code" href="class_sec_plus_1_1_web_framework.html">00230</a> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_web_framework.html">WebFramework</a> {
<a name="l00231"></a>00231 
<a name="l00232"></a><a class="code" href="class_sec_plus_1_1_web_framework.html#a49c7011be9c979d9174c52a8b83e5d8e">00232</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_web_framework.html#a49c7011be9c979d9174c52a8b83e5d8e">$config</a>;
<a name="l00233"></a><a class="code" href="class_sec_plus_1_1_web_framework.html#a388ef7b1db5e6f728e63cee704ce6e23">00233</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_web_framework.html#a388ef7b1db5e6f728e63cee704ce6e23">$controller</a>;
<a name="l00234"></a>00234 
<a name="l00235"></a><a class="code" href="class_sec_plus_1_1_web_framework.html#afe541ae0482352e532ac58d5b8eefe73">00235</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_web_framework.html#afe541ae0482352e532ac58d5b8eefe73">__construct</a>($conf) {
<a name="l00236"></a>00236     $this-&gt;config = $conf;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238     spl_autoload_register(array($this, <span class="stringliteral">&#39;autoload&#39;</span>));
<a name="l00239"></a>00239     $this-&gt;handleController();
<a name="l00240"></a>00240   }
<a name="l00241"></a>00241 
<a name="l00245"></a>00245   <span class="keyword">private</span> function autoload($classname) {
<a name="l00246"></a>00246     $filename = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/Controller$/&#39;</span>, $classname)) {
<a name="l00249"></a>00249       $filename = $this-&gt;config-&gt;getControllerDir();
<a name="l00250"></a>00250     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/DAO$/&#39;</span>, $classname)) {
<a name="l00251"></a>00251       $filename = $this-&gt;config-&gt;getDaoDir();
<a name="l00252"></a>00252     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/View$/&#39;</span>, $classname)) {
<a name="l00253"></a>00253       $filename = $this-&gt;config-&gt;getViewDir();
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255     
<a name="l00256"></a>00256     $filename .=  DIRECTORY_SEPARATOR .  $classname . <span class="stringliteral">&#39;.php&#39;</span>;
<a name="l00257"></a>00257 
<a name="l00262"></a>00262     <span class="keywordflow">if</span> (file_exists($filename) &amp;&amp; in_array($filename, $this-&gt;config-&gt;getSafeFiles()))
<a name="l00263"></a>00263       require $filename;
<a name="l00264"></a>00264     <span class="keywordflow">else</span> {
<a name="l00265"></a>00265       Helper::throwPermissionDeniedInclude($filename);
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267   }
<a name="l00268"></a>00268 
<a name="l00273"></a><a class="code" href="class_sec_plus_1_1_web_framework.html#a6bec752fca753a262360efafd206944c">00273</a>   <span class="keyword">protected</span> function <a class="code" href="class_sec_plus_1_1_web_framework.html#a6bec752fca753a262360efafd206944c">handleController</a>() {
<a name="l00274"></a>00274     $c = Config::getInstance();
<a name="l00275"></a>00275       
<a name="l00276"></a>00276     $controllerName = $c-&gt;getControllerName();
<a name="l00277"></a>00277     $action_name = $c-&gt;getActionName();
<a name="l00278"></a>00278     <span class="keywordflow">if</span> (!empty($_GET[$controllerName])) {
<a name="l00279"></a>00279       $controller = $_GET[$controllerName];
<a name="l00280"></a>00280     } <span class="keywordflow">else</span> {
<a name="l00281"></a>00281       $controller = $c-&gt;getDefaultController();  <span class="comment">// If any controller, this is the default.</span>
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     $class = ucfirst($controller) . <span class="stringliteral">&#39;Controller&#39;</span>;
<a name="l00285"></a>00285     $c = <span class="keyword">new</span> $class();
<a name="l00286"></a>00286     $c-&gt;_setupController();
<a name="l00287"></a>00287     $c-&gt;setup();
<a name="l00288"></a>00288   }
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00294"></a><a class="code" href="interface_sec_plus_1_1_i_controller.html">00294</a> interface <a class="code" href="interface_sec_plus_1_1_i_controller.html">IController</a> {
<a name="l00298"></a>00298   <span class="keyword">public</span> function setup();
<a name="l00299"></a>00299 }
<a name="l00300"></a>00300 
<a name="l00304"></a><a class="code" href="class_sec_plus_1_1_abstract_controller.html">00304</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_abstract_controller.html">AbstractController</a> <span class="keyword">implements</span> <a class="code" href="interface_sec_plus_1_1_i_controller.html">IController</a> {
<a name="l00308"></a><a class="code" href="class_sec_plus_1_1_abstract_controller.html#a49c7011be9c979d9174c52a8b83e5d8e">00308</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_abstract_controller.html#a49c7011be9c979d9174c52a8b83e5d8e">$config</a>;
<a name="l00309"></a>00309 
<a name="l00310"></a><a class="code" href="class_sec_plus_1_1_abstract_controller.html#aefaf43fa290523c54179f350e96f76c0">00310</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_abstract_controller.html#aefaf43fa290523c54179f350e96f76c0">$_controller</a>;
<a name="l00311"></a>00311 
<a name="l00312"></a><a class="code" href="class_sec_plus_1_1_abstract_controller.html#a98d6222017265001c7eb9bcd44ad8ae7">00312</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_abstract_controller.html#a98d6222017265001c7eb9bcd44ad8ae7">$_action</a>;
<a name="l00313"></a>00313 
<a name="l00314"></a><a class="code" href="class_sec_plus_1_1_abstract_controller.html#a7ee199b82a5324150f9b8506fa9c6ad7">00314</a>   <span class="keyword">protected</span> $vars_export = array();
<a name="l00315"></a>00315 
<a name="l00316"></a><a class="code" href="class_sec_plus_1_1_abstract_controller.html#a2114141e9aaf630ff155f81f67d7e406">00316</a>   <span class="keyword">protected</span> $safe_actions = array();
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="class_sec_plus_1_1_abstract_controller.html#aaea51da477f979105350d62a6a213bf8">00318</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_controller.html#aaea51da477f979105350d62a6a213bf8">_setupController</a>() {
<a name="l00319"></a>00319     $this-&gt;config = Config::getInstance();
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     $this-&gt;_controller = !empty($_GET[$this-&gt;config-&gt;getControllerName()]) ?
<a name="l00322"></a>00322       $_GET[$this-&gt;config-&gt;getControllerName()] : $this-&gt;config-&gt;getDefaultAction();
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     $this-&gt;vars_export[<span class="stringliteral">&#39;controller&#39;</span>] = $this-&gt;_controller;
<a name="l00325"></a>00325     
<a name="l00326"></a>00326     $this-&gt;_action = !empty($_GET[$this-&gt;config-&gt;getActionName()]) ?
<a name="l00327"></a>00327       $_GET[$this-&gt;config-&gt;getActionName()] :
<a name="l00328"></a>00328       $this-&gt;config-&gt;getDefaultAction();
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     $this-&gt;vars_export[<span class="stringliteral">&#39;action&#39;</span>] = $this-&gt;_action; 
<a name="l00331"></a>00331     $this-&gt;vars_export[<span class="stringliteral">&#39;web_path&#39;</span>] = $this-&gt;config-&gt;getStaticDir();
<a name="l00332"></a>00332     $this-&gt;vars_export[<span class="stringliteral">&#39;url&#39;</span>] = Config::getProjectBaseUrl();
<a name="l00333"></a>00333     $this-&gt;vars_export[<span class="stringliteral">&#39;title&#39;</span>] = \Config::PROJECT_NAME;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     $this-&gt;safe_actions[] = $this-&gt;config-&gt;getDefaultAction();
<a name="l00336"></a>00336   }
<a name="l00337"></a>00337 
<a name="l00338"></a><a class="code" href="class_sec_plus_1_1_abstract_controller.html#aed6cc3b0ceef7b2c94e31be0c01269f1">00338</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_controller.html#aed6cc3b0ceef7b2c94e31be0c01269f1">handleAction</a>() {
<a name="l00339"></a>00339     <span class="keywordflow">if</span> (in_array($this-&gt;_action, $this-&gt;safe_actions)) {
<a name="l00340"></a>00340       call_user_func(array($this, $this-&gt;_action));
<a name="l00341"></a>00341     } <span class="keywordflow">else</span> {
<a name="l00342"></a>00342       Util::error_security(<span class="stringliteral">&quot;Unknown action or permission denied to execute.&quot;</span>);
<a name="l00343"></a>00343       die();
<a name="l00344"></a>00344     }
<a name="l00345"></a>00345   }
<a name="l00346"></a>00346 
<a name="l00353"></a><a class="code" href="class_sec_plus_1_1_abstract_controller.html#abe9ca2245705c74dc5d6a1a69a68539b">00353</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_controller.html#abe9ca2245705c74dc5d6a1a69a68539b">render</a>($view, $arr_vars = array()) {
<a name="l00354"></a>00354     $view_file = $this-&gt;config-&gt;getViewDir() . DIRECTORY_SEPARATOR . $view . <span class="stringliteral">&#39;View.php&#39;</span>;
<a name="l00355"></a>00355     $safe_files = $this-&gt;config-&gt;getSafeFiles();
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <span class="keywordflow">if</span> (in_array($view_file, $safe_files) &amp;&amp; file_exists($view_file)) {
<a name="l00358"></a>00358       extract($this-&gt;vars_export);
<a name="l00359"></a>00359       extract($arr_vars);
<a name="l00360"></a>00360       include_once($view_file);
<a name="l00361"></a>00361     } <span class="keywordflow">else</span> {
<a name="l00362"></a>00362       Helper::throwPermissionDeniedInclude(basename($view_file));
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364   }
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 
<a name="l00370"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html">00370</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_abstract_model.html">AbstractModel</a> <span class="keyword">implements</span> <a class="code" href="interface_sec_plus_1_1_i_model.html">IModel</a> {
<a name="l00374"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#aa8a5a87b9c1a6a0819b88447cbe41877">00374</a>   <span class="keyword">public</span> <span class="keyword">static</span> $conn = null;
<a name="l00375"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#a49c7011be9c979d9174c52a8b83e5d8e">00375</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_abstract_model.html#a49c7011be9c979d9174c52a8b83e5d8e">$config</a>;
<a name="l00376"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#a90ebc25e748e2696e00b5c5cf3255ee4">00376</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_abstract_model.html#a90ebc25e748e2696e00b5c5cf3255ee4">$_table_name</a>;
<a name="l00377"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#a2889fa8d536a43e949f86d16a732cf95">00377</a>   <span class="keyword">protected</span> $_id_name = <span class="stringliteral">&#39;id&#39;</span>;
<a name="l00378"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#a384569b1003a994ec59b73fdaa7bd0b3">00378</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_abstract_model.html#a384569b1003a994ec59b73fdaa7bd0b3">$_vo_name</a>;
<a name="l00379"></a>00379 
<a name="l00380"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#a095c5d389db211932136b53f25f39685">00380</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_model.html#a095c5d389db211932136b53f25f39685">__construct</a>() {
<a name="l00381"></a>00381     $this-&gt;_connect();
<a name="l00382"></a>00382     $this-&gt;config = \Config::getInstance();
<a name="l00383"></a>00383   }
<a name="l00384"></a>00384   
<a name="l00385"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#a056510893d19074b6d9138db970a8843">00385</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_model.html#a056510893d19074b6d9138db970a8843">_connect</a>() {
<a name="l00386"></a>00386     self::$conn = Database::getConnection();
<a name="l00387"></a>00387   }
<a name="l00388"></a>00388 
<a name="l00389"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#aa4cdca551a2a89730dd30709efbb9b79">00389</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_model.html#aa4cdca551a2a89730dd30709efbb9b79">setTableName</a>($tname) {
<a name="l00390"></a>00390     $this-&gt;_table_name = $tname;
<a name="l00391"></a>00391   }
<a name="l00392"></a>00392 
<a name="l00393"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#a93566f2c8d709d410ae8ec46b813999b">00393</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_model.html#a93566f2c8d709d410ae8ec46b813999b">getTableName</a>() {
<a name="l00394"></a>00394     <span class="keywordflow">return</span> $this-&gt;_table_name;
<a name="l00395"></a>00395   }
<a name="l00396"></a>00396 
<a name="l00397"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#a8f13122998e0dca4db5a421836c2cfc7">00397</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_model.html#a8f13122998e0dca4db5a421836c2cfc7">setValueObjectName</a>($name) {
<a name="l00398"></a>00398     $this-&gt;_vo_name = $name;
<a name="l00399"></a>00399   }
<a name="l00400"></a>00400 
<a name="l00401"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#a4445e53c2e78d3e01fc2880a62b2ef54">00401</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_model.html#a4445e53c2e78d3e01fc2880a62b2ef54">_setupDAO</a>() {
<a name="l00402"></a>00402     $this-&gt;_table_name = !empty($this-&gt;_table_name) ? $this-&gt;_table_name : strtolower(str_replace(__NAMESPACE__, <span class="stringliteral">&quot;&quot;</span>, str_replace(<span class="stringliteral">&#39;DAO&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, get_class($this))));
<a name="l00403"></a>00403     $this-&gt;_vo_name = !empty($this-&gt;_vo_name) ? $this-&gt;_vo_name : ucfirst($this-&gt;_table_name);
<a name="l00404"></a>00404   }
<a name="l00405"></a>00405 
<a name="l00406"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#a50e3bfb586b2f42932a6a93f3fbb0828">00406</a>   <span class="keyword">public</span> function <span class="keyword">get</span>($id) {
<a name="l00407"></a>00407     $this-&gt;_setupDAO();
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="keywordflow">try</span> {
<a name="l00410"></a>00410       $stmt = self::$conn-&gt;prepare(<span class="stringliteral">&quot;SELECT * FROM &quot;</span> . $this-&gt;_table_name . <span class="stringliteral">&quot; WHERE &quot;</span> . $this-&gt;_id_name . <span class="stringliteral">&quot; = :id&quot;</span>);
<a name="l00411"></a>00411       $stmt-&gt;bindParam(<span class="stringliteral">&#39;:id&#39;</span>, $id, \PDO::PARAM_INT);
<a name="l00412"></a>00412       $stmt-&gt;execute();
<a name="l00413"></a>00413 
<a name="l00414"></a>00414       $result = $stmt-&gt;fetchAll();
<a name="l00415"></a>00415 
<a name="l00416"></a>00416       <span class="keywordflow">if</span> (count($result) &gt; 0) {
<a name="l00417"></a>00417         $r = $result[0];
<a name="l00418"></a>00418         $voName = $this-&gt;_vo_name;
<a name="l00419"></a>00419         $obj = <span class="keyword">new</span> $voName();
<a name="l00420"></a>00420         $obj = $this-&gt;map2object($obj, $r);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422         <span class="keywordflow">return</span> $obj;
<a name="l00423"></a>00423       }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425       <span class="keywordflow">return</span> NULL;
<a name="l00426"></a>00426       
<a name="l00427"></a>00427     } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00428"></a>00428       <span class="keywordflow">if</span> ($this-&gt;config-&gt;isDebug()) {
<a name="l00429"></a>00429         print $e-&gt;getMessage();
<a name="l00430"></a>00430         die();
<a name="l00431"></a>00431       } <span class="keywordflow">else</span> {
<a name="l00432"></a>00432         print <span class="stringliteral">&quot;database error.\n&quot;</span>;
<a name="l00433"></a>00433         die();
<a name="l00434"></a>00434       }
<a name="l00435"></a>00435     }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     <span class="keywordflow">return</span> NULL;
<a name="l00438"></a>00438   }
<a name="l00439"></a>00439 
<a name="l00440"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#aba0d5b303383fb5b1fabb5fd01cd3800">00440</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_model.html#aba0d5b303383fb5b1fabb5fd01cd3800">getAll</a>() {
<a name="l00441"></a>00441     $this-&gt;_setupDAO();
<a name="l00442"></a>00442     
<a name="l00443"></a>00443     <span class="keywordflow">try</span> {
<a name="l00444"></a>00444       $stmt = self::$conn-&gt;prepare(<span class="stringliteral">&quot;select * from &quot;</span> . $this-&gt;_table_name);
<a name="l00445"></a>00445       $stmt-&gt;execute();
<a name="l00446"></a>00446 
<a name="l00447"></a>00447       $result = $stmt-&gt;fetchAll();
<a name="l00448"></a>00448       $objects = array();
<a name="l00449"></a>00449 
<a name="l00450"></a>00450       <span class="keywordflow">for</span> ($i = 0; $i &lt; count($result); $i++) {
<a name="l00451"></a>00451         $r = $result[$i];
<a name="l00452"></a>00452         $voName = $this-&gt;_vo_name;
<a name="l00453"></a>00453         $obj = <span class="keyword">new</span> $voName();
<a name="l00454"></a>00454         $obj = $this-&gt;map2object($obj, $r);
<a name="l00455"></a>00455         $objects[] = $obj;
<a name="l00456"></a>00456       }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458       <span class="keywordflow">return</span> $objects;
<a name="l00459"></a>00459     } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00460"></a>00460       <span class="keywordflow">if</span> ($this-&gt;config-&gt;isDebug()) {
<a name="l00461"></a>00461         print $e-&gt;getMessage();
<a name="l00462"></a>00462         die();
<a name="l00463"></a>00463       }
<a name="l00464"></a>00464     }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466     <span class="keywordflow">return</span> NULL;
<a name="l00467"></a>00467   }
<a name="l00468"></a>00468 
<a name="l00469"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#abe62d28c10800e8e62701357e5e1e84a">00469</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_model.html#abe62d28c10800e8e62701357e5e1e84a">update</a>($obj) {
<a name="l00470"></a>00470     $this-&gt;_setupDAO();
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     <span class="keywordflow">try</span> {
<a name="l00473"></a>00473       $data = $obj-&gt;getData();
<a name="l00474"></a>00474       $keys = array_keys($data);
<a name="l00475"></a>00475       $sql = SQLBuilder::update($this-&gt;_table_name, $keys, array($this-&gt;_id_name));
<a name="l00476"></a>00476       $stmt = self::$conn-&gt;prepare($sql);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478       <span class="keywordflow">foreach</span>($data as $name =&gt; &amp;$val) {
<a name="l00479"></a>00479         <span class="keywordflow">if</span> ($name == $this-&gt;_id_name) {
<a name="l00480"></a>00480           <span class="keywordflow">continue</span>;
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483         $stmt-&gt;bindParam(<span class="charliteral">&#39;:&#39;</span> . $name, $val); 
<a name="l00484"></a>00484       }
<a name="l00485"></a>00485       
<a name="l00486"></a>00486       $stmt-&gt;bindParam(<span class="charliteral">&#39;:&#39;</span> . $this-&gt;_id_name, $data[$this-&gt;_id_name], \PDO::PARAM_INT);
<a name="l00487"></a>00487       $stmt-&gt;execute();
<a name="l00488"></a>00488 
<a name="l00489"></a>00489       <span class="keywordflow">return</span> $stmt-&gt;rowCount() &gt; 0;
<a name="l00490"></a>00490     } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00491"></a>00491       <span class="keywordflow">if</span> ($this-&gt;config-&gt;isDebug()) {
<a name="l00492"></a>00492         print $e-&gt;getMessage();
<a name="l00493"></a>00493         die();
<a name="l00494"></a>00494       }
<a name="l00495"></a>00495     }
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <span class="keywordflow">return</span> 0;
<a name="l00498"></a>00498   }
<a name="l00499"></a>00499 
<a name="l00500"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#ad5946f70036ad94a9b1b584fd7be7ae8">00500</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_model.html#ad5946f70036ad94a9b1b584fd7be7ae8">save</a>($obj) {
<a name="l00501"></a>00501     $this-&gt;_setupDAO();
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     <span class="keywordflow">try</span> {
<a name="l00504"></a>00504       $data = $obj-&gt;getData();
<a name="l00505"></a>00505       $keys = array_keys($data);
<a name="l00506"></a>00506       $sql = SQLBuilder::insert($this-&gt;_table_name, $keys, $this-&gt;_id_name);
<a name="l00507"></a>00507       $stmt = self::$conn-&gt;prepare($sql);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509       <span class="keywordflow">foreach</span>($data as $name =&gt; &amp;$val) {
<a name="l00510"></a>00510         <span class="keywordflow">if</span> ($name == $this-&gt;_id_name) {
<a name="l00511"></a>00511           <span class="keywordflow">continue</span>;
<a name="l00512"></a>00512         }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514         $stmt-&gt;bindParam(<span class="charliteral">&#39;:&#39;</span> . $name, $val);
<a name="l00515"></a>00515       }
<a name="l00516"></a>00516       
<a name="l00517"></a>00517       $stmt-&gt;execute();
<a name="l00518"></a>00518 
<a name="l00519"></a>00519       <span class="keywordflow">return</span> $stmt-&gt;rowCount() &gt; 0;
<a name="l00520"></a>00520     } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00521"></a>00521       <span class="keywordflow">if</span> ($this-&gt;config-&gt;isDebug()) {
<a name="l00522"></a>00522         print $e-&gt;getMessage();
<a name="l00523"></a>00523         die();
<a name="l00524"></a>00524       }
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527     <span class="keywordflow">return</span> 0;
<a name="l00528"></a>00528   }
<a name="l00529"></a>00529 
<a name="l00530"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#acfd1dae1579fd97718fdfb087e438b05">00530</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_model.html#acfd1dae1579fd97718fdfb087e438b05">map2object</a>($user, $res) {
<a name="l00531"></a>00531     $keys = array_keys($res);
<a name="l00532"></a>00532     <span class="keywordflow">for</span> ($j = 0; $j &lt; count($keys); $j++) {
<a name="l00533"></a>00533       <span class="keywordflow">if</span> (is_string($keys[$j])) {
<a name="l00534"></a>00534         $user-&gt;{$keys[$j]} = $res[$keys[$j]];
<a name="l00535"></a>00535       }
<a name="l00536"></a>00536     }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="keywordflow">return</span> $user;
<a name="l00539"></a>00539   }
<a name="l00540"></a>00540 
<a name="l00541"></a><a class="code" href="class_sec_plus_1_1_abstract_model.html#a496de406779fbeb7b8b6695809b16271">00541</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_model.html#a496de406779fbeb7b8b6695809b16271">map2array</a>($res) {
<a name="l00542"></a>00542     $ar = array();
<a name="l00543"></a>00543     $keys = array_keys($res);
<a name="l00544"></a>00544     <span class="keywordflow">for</span> ($j = 0; $j &lt; count($keys); $j++) {
<a name="l00545"></a>00545       <span class="keywordflow">if</span> (is_string($keys[$j])) {
<a name="l00546"></a>00546         $ar[] = array($keys[$j], $res[$keys[$j]]);
<a name="l00547"></a>00547       }
<a name="l00548"></a>00548     }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550     <span class="keywordflow">return</span> $ar;
<a name="l00551"></a>00551   }
<a name="l00552"></a>00552 }
<a name="l00553"></a>00553 
<a name="l00557"></a><a class="code" href="interface_sec_plus_1_1_i_model.html">00557</a> interface <a class="code" href="interface_sec_plus_1_1_i_model.html">IModel</a> {
<a name="l00558"></a>00558   
<a name="l00559"></a>00559 }
<a name="l00560"></a>00560 
<a name="l00561"></a><a class="code" href="interface_sec_plus_1_1_i_value_object.html">00561</a> interface <a class="code" href="interface_sec_plus_1_1_i_value_object.html">IValueObject</a> {
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 }
<a name="l00564"></a>00564 
<a name="l00565"></a><a class="code" href="class_sec_plus_1_1_abstract_value_object.html">00565</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_abstract_value_object.html">AbstractValueObject</a> <span class="keyword">implements</span> <a class="code" href="interface_sec_plus_1_1_i_value_object.html">IValueObject</a> {
<a name="l00566"></a><a class="code" href="class_sec_plus_1_1_abstract_value_object.html#a5a3006290f2de94fff2dd63ca739d15a">00566</a>   <span class="keyword">protected</span> $_data = array();
<a name="l00567"></a>00567 
<a name="l00568"></a><a class="code" href="class_sec_plus_1_1_abstract_value_object.html#ab590703a68f21a9a704498e83e72a252">00568</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_value_object.html#ab590703a68f21a9a704498e83e72a252">__set</a>($name, $val) {
<a name="l00569"></a>00569     $this-&gt;_data[$name] = $val;
<a name="l00570"></a>00570   }
<a name="l00571"></a>00571 
<a name="l00572"></a><a class="code" href="class_sec_plus_1_1_abstract_value_object.html#abc8e9e31bb15c8a44c3210ec551407c8">00572</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_value_object.html#abc8e9e31bb15c8a44c3210ec551407c8">__get</a>($name) {
<a name="l00573"></a>00573     <span class="keywordflow">if</span> (array_key_exists($name, $this-&gt;_data)) {
<a name="l00574"></a>00574       <span class="keywordflow">return</span> $this-&gt;_data[$name];
<a name="l00575"></a>00575     } <span class="keywordflow">else</span> {
<a name="l00576"></a>00576       <span class="keywordflow">return</span> NULL;
<a name="l00577"></a>00577     }
<a name="l00578"></a>00578   }
<a name="l00579"></a>00579 
<a name="l00580"></a><a class="code" href="class_sec_plus_1_1_abstract_value_object.html#a8f132f051b7cd7d570ccb9f6e2bb4201">00580</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_value_object.html#a8f132f051b7cd7d570ccb9f6e2bb4201">__isset</a>($name) {
<a name="l00581"></a>00581     <span class="keywordflow">return</span> isset($this-&gt;_data[$name]);
<a name="l00582"></a>00582   }
<a name="l00583"></a>00583 
<a name="l00584"></a><a class="code" href="class_sec_plus_1_1_abstract_value_object.html#a8a93654c7bfe3f0a9bb7af531e513d44">00584</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_value_object.html#a8a93654c7bfe3f0a9bb7af531e513d44">__unset</a>($name) {
<a name="l00585"></a>00585     unset($this-&gt;_data[$name]);
<a name="l00586"></a>00586   }
<a name="l00587"></a>00587   
<a name="l00588"></a><a class="code" href="class_sec_plus_1_1_abstract_value_object.html#addda52da3f818413b045c9dc45409b7c">00588</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_value_object.html#addda52da3f818413b045c9dc45409b7c">__call</a>($func, $args) {
<a name="l00589"></a>00589     <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^get/&#39;</span>, $func) &amp;&amp; count($args) == 0) {
<a name="l00590"></a>00590       $prop = lcfirst(substr($func, 3));
<a name="l00591"></a>00591       <span class="keywordflow">if</span> (!empty($prop)) {
<a name="l00592"></a>00592         <span class="keywordflow">return</span> $this-&gt;_data[$prop];
<a name="l00593"></a>00593       }
<a name="l00594"></a>00594     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^set/&#39;</span>, $func) &amp;&amp; count($args) == 1) {
<a name="l00595"></a>00595       $prop = lcfirst(substr($func, 3));
<a name="l00596"></a>00596       <span class="keywordflow">if</span> (!empty($prop)) {
<a name="l00597"></a>00597         $this-&gt;_data[$prop] = $args[0];
<a name="l00598"></a>00598         <span class="keywordflow">return</span>;
<a name="l00599"></a>00599       }
<a name="l00600"></a>00600     }
<a name="l00601"></a>00601   }
<a name="l00602"></a>00602 
<a name="l00603"></a><a class="code" href="class_sec_plus_1_1_abstract_value_object.html#a81a67162a6288d78fc4c55283325f0b4">00603</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_value_object.html#a81a67162a6288d78fc4c55283325f0b4">getData</a>() {
<a name="l00604"></a>00604     <span class="keywordflow">return</span> $this-&gt;_data;
<a name="l00605"></a>00605   }
<a name="l00606"></a>00606 }
<a name="l00607"></a>00607 
<a name="l00611"></a><a class="code" href="class_sec_plus_1_1_database.html">00611</a> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_database.html">Database</a> {
<a name="l00612"></a>00612   <span class="keyword">private</span> <span class="keyword">static</span> $conn = null;
<a name="l00613"></a>00613 
<a name="l00614"></a>00614   <span class="keyword">private</span> function __construct() {
<a name="l00618"></a>00618   }
<a name="l00619"></a>00619 
<a name="l00623"></a><a class="code" href="class_sec_plus_1_1_database.html#a6b25efc0b7bf136a727f36f22577b06c">00623</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_database.html#a6b25efc0b7bf136a727f36f22577b06c">getConnection</a>() {
<a name="l00624"></a>00624     $config = Config::getInstance();
<a name="l00625"></a>00625     <span class="keywordflow">try</span> {
<a name="l00626"></a>00626       $dbms = $config-&gt;getDbms();
<a name="l00627"></a>00627       $host = $config-&gt;getDbHost();
<a name="l00628"></a>00628       $user = $config-&gt;getDbUser();
<a name="l00629"></a>00629       $pass = $config-&gt;getDbPass();
<a name="l00630"></a>00630       $dbname = $config-&gt;getDbDatabase();
<a name="l00631"></a>00631         
<a name="l00632"></a>00632       $datasource = $dbms . <span class="stringliteral">&quot;:&quot;</span> . <span class="stringliteral">&quot;host=&quot;</span> . $host . <span class="stringliteral">&quot;;dbname=&quot;</span> . $dbname;
<a name="l00633"></a>00633       
<a name="l00634"></a>00634       self::$conn = <span class="keyword">new</span> \PDO($datasource, $user, $pass);
<a name="l00635"></a>00635       self::$conn-&gt;setAttribute(\PDO::ATTR_ERRMODE, \PDO::ERRMODE_EXCEPTION); <span class="comment">// Set Errorhandling to Exception</span>
<a name="l00636"></a>00636 
<a name="l00637"></a>00637       <span class="keywordflow">return</span> self::$conn;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639     } <span class="keywordflow">catch</span> (PDOException $e) {
<a name="l00640"></a>00640       <span class="keywordflow">if</span> ($config-&gt;isDebug()) {
<a name="l00641"></a>00641         print <span class="stringliteral">&quot;Database connection error.&quot;</span>;
<a name="l00642"></a>00642       } <span class="keywordflow">else</span> {
<a name="l00643"></a>00643         print <span class="stringliteral">&quot;Database connection error: &quot;</span> . $e-&gt;getMessage();
<a name="l00644"></a>00644       }
<a name="l00645"></a>00645       die();
<a name="l00646"></a>00646     } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00647"></a>00647       print <span class="stringliteral">&quot;error: &quot;</span> . $e-&gt;getMessage();
<a name="l00648"></a>00648       die();
<a name="l00649"></a>00649     }    
<a name="l00650"></a>00650   }
<a name="l00651"></a>00651 
<a name="l00652"></a><a class="code" href="class_sec_plus_1_1_database.html#a10b1f5e81bf91204d59ec801e482334a">00652</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_database.html#a10b1f5e81bf91204d59ec801e482334a">closeConnection</a>() {
<a name="l00653"></a>00653     self::$conn = null;
<a name="l00654"></a>00654   }
<a name="l00655"></a>00655 }
<a name="l00656"></a>00656 
<a name="l00657"></a><a class="code" href="class_sec_plus_1_1_s_q_l_builder.html">00657</a> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_s_q_l_builder.html">SQLBuilder</a> {
<a name="l00658"></a><a class="code" href="class_sec_plus_1_1_s_q_l_builder.html#aa2a6b51cfee6ddff6a9c08c9810a4ac7">00658</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_s_q_l_builder.html#aa2a6b51cfee6ddff6a9c08c9810a4ac7">update</a>($table_name, $values, $where = NULL) {
<a name="l00659"></a>00659     $sql = <span class="stringliteral">&quot;UPDATE &quot;</span> . $table_name . <span class="stringliteral">&quot; SET &quot;</span>;
<a name="l00660"></a>00660     <span class="keywordflow">if</span> (count($values) &lt; 1) {
<a name="l00661"></a>00661       <span class="keywordflow">return</span> NULL;
<a name="l00662"></a>00662     }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664     $l = count($values);
<a name="l00665"></a>00665     <span class="keywordflow">for</span> ($i = 0; $i &lt; $l; $i++) {
<a name="l00666"></a>00666       $sql .= $values[$i] . <span class="stringliteral">&quot; = :&quot;</span> . $values[$i];
<a name="l00667"></a>00667       <span class="keywordflow">if</span> ($i &lt; ($l - 1)) {
<a name="l00668"></a>00668         $sql .= <span class="stringliteral">&quot;, &quot;</span>;
<a name="l00669"></a>00669       }
<a name="l00670"></a>00670     }
<a name="l00671"></a>00671 
<a name="l00672"></a>00672     <span class="keywordflow">if</span> (!empty($where)) {
<a name="l00673"></a>00673       $sql .= <span class="stringliteral">&quot; WHERE &quot;</span>;
<a name="l00674"></a>00674       $l = count($where);
<a name="l00675"></a>00675       <span class="keywordflow">for</span> ($i = 0; $i &lt; $l; $i++) {
<a name="l00676"></a>00676         $sql .= $where[$i] . <span class="stringliteral">&quot; = :&quot;</span> . $where[$i];
<a name="l00677"></a>00677         <span class="keywordflow">if</span> ($i &lt; ($l - 1)) {
<a name="l00678"></a>00678           $sql .= <span class="stringliteral">&quot; AND &quot;</span>;
<a name="l00679"></a>00679         }
<a name="l00680"></a>00680       }
<a name="l00681"></a>00681     }
<a name="l00682"></a>00682 
<a name="l00683"></a>00683     <span class="keywordflow">return</span> $sql;
<a name="l00684"></a>00684   }
<a name="l00685"></a>00685 
<a name="l00686"></a><a class="code" href="class_sec_plus_1_1_s_q_l_builder.html#a8dad9df759e4dce6be5347b83212fe59">00686</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_s_q_l_builder.html#a8dad9df759e4dce6be5347b83212fe59">insert</a>($table_name, $values, $primary_key = <span class="stringliteral">&#39;id&#39;</span>) {
<a name="l00687"></a>00687     $sql = <span class="stringliteral">&quot;INSERT INTO &quot;</span> . $table_name;
<a name="l00688"></a>00688     <span class="keywordflow">if</span> (count($values) &lt; 1) {
<a name="l00689"></a>00689       <span class="keywordflow">return</span> NULL;
<a name="l00690"></a>00690     }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692     $l = count($values);
<a name="l00693"></a>00693     <span class="keywordflow">if</span> ($l &lt; 1) {
<a name="l00694"></a>00694       <span class="keywordflow">return</span> NULL;
<a name="l00695"></a>00695     }
<a name="l00696"></a>00696 
<a name="l00697"></a>00697     $sql .= <span class="stringliteral">&quot; (&quot;</span>;
<a name="l00698"></a>00698     
<a name="l00699"></a>00699     <span class="keywordflow">for</span> ($i = 0; $i &lt; $l; $i++) {
<a name="l00700"></a>00700       <span class="keywordflow">if</span> ($values[$i] == $primary_key) {
<a name="l00701"></a>00701         <span class="keywordflow">continue</span>;
<a name="l00702"></a>00702       }
<a name="l00703"></a>00703       $sql .= $values[$i];
<a name="l00704"></a>00704       <span class="keywordflow">if</span> ($i &lt; ($l - 1)) {
<a name="l00705"></a>00705         $sql .= <span class="stringliteral">&quot;, &quot;</span>;
<a name="l00706"></a>00706       }
<a name="l00707"></a>00707     }
<a name="l00708"></a>00708 
<a name="l00709"></a>00709     $sql .= <span class="stringliteral">&quot;) VALUES (&quot;</span>;
<a name="l00710"></a>00710 
<a name="l00711"></a>00711     <span class="keywordflow">for</span> ($i = 0; $i &lt; $l; $i++) {
<a name="l00712"></a>00712       <span class="keywordflow">if</span> ($values[$i] == $primary_key) {
<a name="l00713"></a>00713         <span class="keywordflow">continue</span>;
<a name="l00714"></a>00714       }
<a name="l00715"></a>00715       
<a name="l00716"></a>00716       $sql .= <span class="charliteral">&#39;:&#39;</span> . $values[$i];
<a name="l00717"></a>00717       <span class="keywordflow">if</span> ($i &lt; ($l - 1)) {
<a name="l00718"></a>00718         $sql .= <span class="stringliteral">&quot;, &quot;</span>;
<a name="l00719"></a>00719       }
<a name="l00720"></a>00720     }
<a name="l00721"></a>00721 
<a name="l00722"></a>00722     $sql .= <span class="charliteral">&#39;)&#39;</span>;
<a name="l00723"></a>00723 
<a name="l00724"></a>00724     <span class="keywordflow">return</span> $sql;
<a name="l00725"></a>00725   }
<a name="l00726"></a>00726 }
<a name="l00727"></a>00727 
<a name="l00728"></a><a class="code" href="class_sec_plus_1_1_util.html">00728</a> <span class="keyword">final</span> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_util.html">Util</a> {
<a name="l00729"></a><a class="code" href="class_sec_plus_1_1_util.html#a665352eccba93eb09fbcbb4891ba7c1e">00729</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_util.html#a665352eccba93eb09fbcbb4891ba7c1e">error_security</a>($text, $inc_html_header = <span class="keyword">true</span>) {
<a name="l00730"></a>00730     <span class="keywordflow">if</span> ($inc_html_header) {
<a name="l00731"></a>00731       Helper::print_html_header();      
<a name="l00732"></a>00732     }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734     $content = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     $content .= <span class="stringliteral">&#39;&lt;div style=&quot;border: 1px solid red; width: 600px; background-color: #ccc&quot;&gt;&#39;</span>;
<a name="l00737"></a>00737     $content .= <span class="stringliteral">&quot;SecPlus-PHP&gt; Security prevention: &quot;</span>;
<a name="l00738"></a>00738     $content .= htmlentities($text);
<a name="l00739"></a>00739     $content .= <span class="stringliteral">&quot;\n&lt;/div&gt;&quot;</span>;
<a name="l00740"></a>00740 
<a name="l00741"></a>00741     print $content;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743     <span class="keywordflow">if</span> ($inc_html_header) {
<a name="l00744"></a>00744       Helper::print_html_footer();
<a name="l00745"></a>00745     }
<a name="l00746"></a>00746   }
<a name="l00747"></a>00747 }
<a name="l00748"></a>00748 
<a name="l00752"></a><a class="code" href="class_sec_plus_1_1_helper.html">00752</a> <span class="keyword">final</span> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_helper.html">Helper</a> {
<a name="l00757"></a><a class="code" href="class_sec_plus_1_1_helper.html#a2eccf64c434dce4bdc22599c553d6958">00757</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_helper.html#a2eccf64c434dce4bdc22599c553d6958">html_doctype</a>() {
<a name="l00758"></a>00758     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;!DOCTYPE html PUBLIC \&quot;-//W3C//DTD XHTML 1.0 Strict//EN\&quot; \&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\&quot;&gt;\n&lt;html xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot; xml:lang=\&quot;en\&quot; lang=\&quot;en\&quot;&gt;&quot;</span>;
<a name="l00759"></a>00759   }
<a name="l00760"></a>00760 
<a name="l00761"></a><a class="code" href="class_sec_plus_1_1_helper.html#afa332dc931fb2db52cec5e445d001f9e">00761</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_helper.html#afa332dc931fb2db52cec5e445d001f9e">html_footer</a>() {
<a name="l00762"></a>00762     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>;
<a name="l00763"></a>00763   }
<a name="l00764"></a>00764 
<a name="l00765"></a><a class="code" href="class_sec_plus_1_1_helper.html#a0699678cd9d874a83564c2f77c1796fd">00765</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_helper.html#a0699678cd9d874a83564c2f77c1796fd">print_html_footer</a>() { print Helper::html_footer(); }
<a name="l00766"></a>00766 
<a name="l00771"></a><a class="code" href="class_sec_plus_1_1_helper.html#a4769a0d4d99640687282371b6880869f">00771</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_helper.html#a4769a0d4d99640687282371b6880869f">print_html_doctype</a>() { print SecPlus\Helper::html_doctype(); }
<a name="l00772"></a>00772 
<a name="l00778"></a><a class="code" href="class_sec_plus_1_1_helper.html#a78dac94567ed19b36739d0b92d7aaa6b">00778</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_helper.html#a78dac94567ed19b36739d0b92d7aaa6b">html_header</a>($charset = <span class="stringliteral">&#39;utf-8&#39;</span>) {
<a name="l00779"></a>00779     $c = \Config::getInstance();
<a name="l00780"></a>00780     $html = Helper::html_doctype() . <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00781"></a>00781     $html .= <span class="stringliteral">&quot;&lt;head&gt;\n&lt;meta http-equiv=\&quot;Content-type\&quot; content=\&quot;text/html; charset=&quot;</span> . $charset . <span class="stringliteral">&quot;\&quot; /&gt;\n&quot;</span>;
<a name="l00782"></a>00782     $html .= <span class="stringliteral">&quot;&lt;title&gt;&quot;</span> . $c::PROJECT_NAME . <span class="stringliteral">&quot;&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&quot;</span>;
<a name="l00783"></a>00783     <span class="keywordflow">return</span> $html;
<a name="l00784"></a>00784   }
<a name="l00785"></a><a class="code" href="class_sec_plus_1_1_helper.html#a9fa2928305832c296afcd2c0c3294119">00785</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_helper.html#a9fa2928305832c296afcd2c0c3294119">print_html_header</a>($charset = <span class="stringliteral">&#39;utf-8&#39;</span>) { print Helper::html_header($charset); }
<a name="l00786"></a><a class="code" href="class_sec_plus_1_1_helper.html#af4615286d5ed963c88b6d8f13463f8e0">00786</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_helper.html#af4615286d5ed963c88b6d8f13463f8e0">http_redirect</a>($url) { header(<span class="stringliteral">&quot;Location: $url&quot;</span>); }
<a name="l00787"></a><a class="code" href="class_sec_plus_1_1_helper.html#a4cbf648b3f3fdf7eddf1834fb0f35305">00787</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_helper.html#a4cbf648b3f3fdf7eddf1834fb0f35305">html_redirect</a>($url, $time) { print <span class="stringliteral">&#39;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;&#39;</span> . htmlentities($time) . <span class="stringliteral">&#39;; url=&#39;</span> . $url . <span class="stringliteral">&#39;&quot;&gt;&#39;</span>; }
<a name="l00788"></a><a class="code" href="class_sec_plus_1_1_helper.html#acf2e51d400bd9340247809adb9cd0664">00788</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_helper.html#acf2e51d400bd9340247809adb9cd0664">alert</a>($msg) { print <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;&#39;</span> . $msg . <span class="stringliteral">&#39;&quot;);&lt;/script&gt;&#39;</span>; }
<a name="l00789"></a><a class="code" href="class_sec_plus_1_1_helper.html#ae9f4828bdc8ae1f262eb0b6154d4c531">00789</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_helper.html#ae9f4828bdc8ae1f262eb0b6154d4c531">throwPermissionDeniedInclude</a>($filename) {
<a name="l00790"></a>00790     $c = Config::getInstance();
<a name="l00791"></a>00791     <span class="keywordflow">if</span> ($c-&gt;getEnvironment() == Config::ENV_DEVELOPMENT) {
<a name="l00792"></a>00792       <span class="keywordflow">throw</span> <span class="keyword">new</span> \Exception(<span class="stringliteral">&#39;&lt;span style=&quot;color: white; background-color: red;&quot;&gt;File &#39;</span> . htmlentities($filename) . <span class="stringliteral">&#39; not found or permission denied to include.&lt;/span&gt;&lt;br&gt;&lt;br&gt;&#39;</span>);
<a name="l00793"></a>00793     } <span class="keywordflow">else</span> {
<a name="l00794"></a>00794       <span class="comment">/* Blind error */</span>
<a name="l00795"></a>00795       <span class="keywordflow">throw</span> <span class="keyword">new</span> \Exception(<span class="stringliteral">&quot;&lt;span style=\&quot;color: white; background-color: red;\&quot;&gt;Fatal Error!&lt;/span&gt;&quot;</span>);
<a name="l00796"></a>00796     }
<a name="l00797"></a>00797     die();
<a name="l00798"></a>00798   }
<a name="l00799"></a>00799 }
<a name="l00800"></a>00800 
<a name="l00801"></a><a class="code" href="interface_sec_plus_1_1_i_auth_controller.html">00801</a> interface <a class="code" href="interface_sec_plus_1_1_i_auth_controller.html">IAuthController</a> {
<a name="l00802"></a>00802   <span class="keyword">public</span> function permissionDenied();
<a name="l00803"></a>00803 }
<a name="l00804"></a>00804 
<a name="l00805"></a><a class="code" href="class_sec_plus_1_1_abstract_auth_controller.html">00805</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_abstract_auth_controller.html">AbstractAuthController</a>
<a name="l00806"></a>00806 <span class="keyword">extends</span> <a class="code" href="class_sec_plus_1_1_abstract_controller.html">AbstractController</a>
<a name="l00807"></a>00807 implements <a class="code" href="interface_sec_plus_1_1_i_auth_controller.html">IAuthController</a> {
<a name="l00808"></a><a class="code" href="class_sec_plus_1_1_abstract_auth_controller.html#abefb3c26429d514777313e9a63d7cbac">00808</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_abstract_auth_controller.html#abefb3c26429d514777313e9a63d7cbac">$session</a>;
<a name="l00809"></a><a class="code" href="class_sec_plus_1_1_abstract_auth_controller.html#a00ae4fcafb1145f5e968bdf920f83e2e">00809</a>   <span class="keyword">protected</span> $token = array();
<a name="l00810"></a>00810 
<a name="l00811"></a><a class="code" href="class_sec_plus_1_1_abstract_auth_controller.html#a095c5d389db211932136b53f25f39685">00811</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_abstract_auth_controller.html#a095c5d389db211932136b53f25f39685">__construct</a>() {
<a name="l00812"></a>00812     session_start();
<a name="l00813"></a>00813     $this-&gt;checkPermissions();
<a name="l00814"></a>00814   }
<a name="l00815"></a>00815 
<a name="l00816"></a><a class="code" href="class_sec_plus_1_1_abstract_auth_controller.html#a0a1c779ae3e8e7acbed8872b1bba3fce">00816</a>   <span class="keyword">protected</span> function <a class="code" href="class_sec_plus_1_1_abstract_auth_controller.html#a0a1c779ae3e8e7acbed8872b1bba3fce">checkPermissions</a>() {
<a name="l00817"></a>00817     <span class="keywordflow">if</span> (empty($session)) {
<a name="l00818"></a>00818       $this-&gt;permissionDenied();
<a name="l00819"></a>00819     }
<a name="l00820"></a>00820   }
<a name="l00821"></a>00821 }
<a name="l00822"></a>00822 
<a name="l00823"></a><a class="code" href="class_sec_plus_1_1_auth.html">00823</a> <span class="keyword">final</span> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_auth.html">Auth</a> {
<a name="l00824"></a><a class="code" href="class_sec_plus_1_1_auth.html#aebcabec1a58bbfd932aff3840e898542">00824</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_auth.html#aebcabec1a58bbfd932aff3840e898542">initSession</a>($name = <span class="stringliteral">&#39;secplus_auth_session&#39;</span>) {
<a name="l00825"></a>00825     <span class="keywordflow">if</span> (!empty($_SESSION)) {
<a name="l00826"></a>00826       Auth::destroySession();
<a name="l00827"></a>00827     }
<a name="l00828"></a>00828     session_start();
<a name="l00829"></a>00829     $_SESSION[<span class="stringliteral">&#39;session_start_at&#39;</span>] = time();
<a name="l00830"></a>00830     $_SESSION[$name] = <span class="keyword">true</span>;
<a name="l00831"></a>00831   }
<a name="l00832"></a>00832 
<a name="l00833"></a><a class="code" href="class_sec_plus_1_1_auth.html#a42211714539e611c949fd92916a52f92">00833</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_auth.html#a42211714539e611c949fd92916a52f92">addSession</a>($namevalue = array()) {
<a name="l00834"></a>00834     <span class="keywordflow">foreach</span> ($namevalue as $key =&gt; $value) {
<a name="l00835"></a>00835       $_SESSION[$key] = $value;
<a name="l00836"></a>00836     }
<a name="l00837"></a>00837   }
<a name="l00838"></a>00838 
<a name="l00839"></a><a class="code" href="class_sec_plus_1_1_auth.html#a3e7a33d4c86314a6333129bfb3c9883c">00839</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_auth.html#a3e7a33d4c86314a6333129bfb3c9883c">hasSession</a>($name) {
<a name="l00840"></a>00840     <span class="keywordflow">return</span> !empty($_SESSION) &amp;&amp; !empty($_SESSION[$name]);
<a name="l00841"></a>00841   }
<a name="l00842"></a>00842 
<a name="l00843"></a><a class="code" href="class_sec_plus_1_1_auth.html#a17da8a64806b58c08fd59d1dcc72bbcb">00843</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_auth.html#a17da8a64806b58c08fd59d1dcc72bbcb">destroySession</a>() {
<a name="l00844"></a>00844     session_destroy();
<a name="l00845"></a>00845     unset($_SESSION);
<a name="l00846"></a>00846   }
<a name="l00847"></a>00847 }
<a name="l00848"></a>00848 
<a name="l00849"></a><a class="code" href="interface_sec_plus_1_1_i_shell_command.html">00849</a> interface <a class="code" href="interface_sec_plus_1_1_i_shell_command.html">IShellCommand</a> {
<a name="l00850"></a>00850   <span class="keyword">public</span> function help();
<a name="l00851"></a>00851 }
<a name="l00852"></a>00852 
<a name="l00853"></a><a class="code" href="class_sec_plus_1_1_shell_cmd.html">00853</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_shell_cmd.html">ShellCmd</a> <span class="keyword">implements</span> <a class="code" href="interface_sec_plus_1_1_i_shell_command.html">IShellCommand</a> {
<a name="l00854"></a><a class="code" href="class_sec_plus_1_1_shell_cmd.html#a49c7011be9c979d9174c52a8b83e5d8e">00854</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_shell_cmd.html#a49c7011be9c979d9174c52a8b83e5d8e">$config</a>;
<a name="l00855"></a><a class="code" href="class_sec_plus_1_1_shell_cmd.html#ae6059ea82d657151d1d5b4f5c5ef9177">00855</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_shell_cmd.html#ae6059ea82d657151d1d5b4f5c5ef9177">$config_file</a>;
<a name="l00856"></a><a class="code" href="class_sec_plus_1_1_shell_cmd.html#a3f36281fff00b24d2d26e08841d336d9">00856</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_shell_cmd.html#a3f36281fff00b24d2d26e08841d336d9">$project_dir</a>;
<a name="l00857"></a>00857 
<a name="l00858"></a><a class="code" href="class_sec_plus_1_1_shell_cmd.html#ae3daa4d9ba435527d12f92373e9a4423">00858</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_shell_cmd.html#ae3daa4d9ba435527d12f92373e9a4423">setConfig</a>($c) {
<a name="l00859"></a>00859     $this-&gt;config = $c;
<a name="l00860"></a>00860   }
<a name="l00861"></a>00861 
<a name="l00862"></a><a class="code" href="class_sec_plus_1_1_shell_cmd.html#a5ad9433c02429d7515c6a595359c3d47">00862</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_shell_cmd.html#a5ad9433c02429d7515c6a595359c3d47">setConfigFile</a>($c) {
<a name="l00863"></a>00863     $this-&gt;config_file = $c;
<a name="l00864"></a>00864   }
<a name="l00865"></a>00865   
<a name="l00870"></a><a class="code" href="class_sec_plus_1_1_shell_cmd.html#a34e81bc2914b5ebf66ed922868112c74">00870</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_shell_cmd.html#a34e81bc2914b5ebf66ed922868112c74">print_status</a>($text) {
<a name="l00871"></a>00871     print $text;
<a name="l00872"></a>00872   }
<a name="l00873"></a>00873   
<a name="l00874"></a><a class="code" href="class_sec_plus_1_1_shell_cmd.html#a353f14a0626a5d4ee573bee59f61cd71">00874</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_shell_cmd.html#a353f14a0626a5d4ee573bee59f61cd71">print_success</a>($text) {
<a name="l00875"></a>00875     $t = <span class="stringliteral">&quot;[+] &quot;</span> . $text .  <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00876"></a>00876     print $t;
<a name="l00877"></a>00877   }
<a name="l00878"></a>00878 
<a name="l00879"></a><a class="code" href="class_sec_plus_1_1_shell_cmd.html#a54d9f0a951247e83966cd51ea8a597cd">00879</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_shell_cmd.html#a54d9f0a951247e83966cd51ea8a597cd">print_error</a>($text) {
<a name="l00880"></a>00880     $t = <span class="stringliteral">&quot;[-] &quot;</span> . $text . <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00881"></a>00881     print $t;
<a name="l00882"></a>00882   }
<a name="l00883"></a>00883 }
<a name="l00884"></a>00884 
<a name="l00885"></a><a class="code" href="class_sec_plus_1_1_help_command.html">00885</a> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_help_command.html">HelpCommand</a> <span class="keyword">extends</span> <a class="code" href="class_sec_plus_1_1_shell_cmd.html">ShellCmd</a> {
<a name="l00886"></a><a class="code" href="class_sec_plus_1_1_help_command.html#a999491405b08d7cd92d311fb3453be9d">00886</a>   <span class="keyword">public</span> function <span class="keyword">auto</span>() {
<a name="l00887"></a>00887     $classes = get_declared_classes();
<a name="l00888"></a>00888 
<a name="l00889"></a>00889     <span class="keywordflow">foreach</span>($classes as $c) {
<a name="l00890"></a>00890       <span class="keywordflow">if</span> (strstr($c, <span class="stringliteral">&#39;Command&#39;</span>)) {
<a name="l00891"></a>00891         $command = str_replace(<span class="stringliteral">&#39;Command&#39;</span>, <span class="stringliteral">&quot;&quot;</span>, $c);
<a name="l00892"></a>00892         $command = str_replace(__NAMESPACE__ . <span class="charliteral">&#39;\\&#39;</span>, <span class="stringliteral">&quot;&quot;</span>, $command);
<a name="l00893"></a>00893         $command = strtolower($command);
<a name="l00894"></a>00894         $this-&gt;print_success($command);
<a name="l00895"></a>00895       }
<a name="l00896"></a>00896     }
<a name="l00897"></a>00897   }
<a name="l00898"></a>00898 
<a name="l00899"></a><a class="code" href="class_sec_plus_1_1_help_command.html#a91482c4db18186b33acbaf1528a50ddc">00899</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_help_command.html#a91482c4db18186b33acbaf1528a50ddc">help</a>() {
<a name="l00900"></a>00900     $this-&gt;<span class="keyword">auto</span>;
<a name="l00901"></a>00901   }
<a name="l00902"></a>00902 }
<a name="l00903"></a>00903 
<a name="l00904"></a><a class="code" href="class_sec_plus_1_1_create_command.html">00904</a> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_create_command.html">CreateCommand</a> <span class="keyword">extends</span> <a class="code" href="class_sec_plus_1_1_shell_cmd.html">ShellCmd</a> {
<a name="l00905"></a><a class="code" href="class_sec_plus_1_1_create_command.html#a8dcb58659bb143a53097bc6ef8d550c8">00905</a>   <span class="keyword">protected</span> $abstractModelClass = <span class="stringliteral">&#39;SecPlus\AbstractModel&#39;</span>;
<a name="l00906"></a>00906   
<a name="l00907"></a><a class="code" href="class_sec_plus_1_1_create_command.html#a9147b452afc1ea079f6dc5c9da834307">00907</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_create_command.html#a9147b452afc1ea079f6dc5c9da834307">__construct</a>($config, $project_dir) {
<a name="l00908"></a>00908     $this-&gt;config = $config;
<a name="l00909"></a>00909     $this-&gt;project_dir = $project_dir;
<a name="l00910"></a>00910   }
<a name="l00911"></a>00911 
<a name="l00912"></a><a class="code" href="class_sec_plus_1_1_create_command.html#a91482c4db18186b33acbaf1528a50ddc">00912</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_create_command.html#a91482c4db18186b33acbaf1528a50ddc">help</a>() {
<a name="l00913"></a>00913     $this-&gt;print_status(<span class="stringliteral">&quot;create help:\n&quot;</span>);
<a name="l00914"></a>00914     $this-&gt;print_status(<span class="stringliteral">&quot;Command to generate scaffolding. With &#39;create&#39; you could create\n&quot;</span>);
<a name="l00915"></a>00915     $this-&gt;print_status(<span class="stringliteral">&quot;CRUD&#39;s, model&#39;s, DAO&#39;s, VO&#39;s, unit-tests, etc.\n&quot;</span>);
<a name="l00916"></a>00916     $this-&gt;print_status(<span class="stringliteral">&quot;Usage: create &lt;action&gt; [&lt;opt1&gt; &lt;opt2&gt; ... &lt;optN&gt;]\n&quot;</span>);
<a name="l00917"></a>00917     $this-&gt;print_status(<span class="stringliteral">&quot;Actions:\n&quot;</span>);
<a name="l00918"></a>00918     $this-&gt;print_status(<span class="stringliteral">&quot;\tproject\t\tCreate new project. Based on Configuration file.\n&quot;</span>);
<a name="l00919"></a>00919     $this-&gt;print_status(<span class="stringliteral">&quot;\t\tUsage: create project\n\n&quot;</span>);
<a name="l00920"></a>00920     $this-&gt;print_status(<span class="stringliteral">&quot;\tdao\t\tCreate new DAO.\n&quot;</span>);
<a name="l00921"></a>00921     $this-&gt;print_status(<span class="stringliteral">&quot;\t\tUsage: create dao &lt;name-of-DAO&gt; [,&lt;name-of-table&gt;]\n\n&quot;</span>);
<a name="l00922"></a>00922     $this-&gt;print_status(<span class="stringliteral">&quot;\tvalueobject\tCreate new ValueObject.\n&quot;</span>);
<a name="l00923"></a>00923     $this-&gt;print_status(<span class="stringliteral">&quot;\t\tUsage: create valueobject &lt;name-of-vo&gt;\n\n&quot;</span>);
<a name="l00924"></a>00924     $this-&gt;print_status(<span class="stringliteral">&quot;\tconfigfile\tCreate new Configuration File.\n&quot;</span>);
<a name="l00925"></a>00925     $this-&gt;print_status(<span class="stringliteral">&quot;\t\tUsage: create configfile [,&lt;output-path&gt;]\n\n&quot;</span>);
<a name="l00926"></a>00926     $this-&gt;print_status(<span class="stringliteral">&quot;\tindex\t\tCreate new index PHP file.\n&quot;</span>);
<a name="l00927"></a>00927     $this-&gt;print_status(<span class="stringliteral">&quot;\t\tUsage: create index [,&lt;output-path&gt;]\n\n&quot;</span>);
<a name="l00928"></a>00928     $this-&gt;print_status(<span class="stringliteral">&quot;\tdirectories\tCreate new project directories.\n&quot;</span>);
<a name="l00929"></a>00929     $this-&gt;print_status(<span class="stringliteral">&quot;\t\tUsage: create directories\n\n&quot;</span>);
<a name="l00930"></a>00930     $this-&gt;print_status(<span class="stringliteral">&quot;\n&quot;</span>);     
<a name="l00931"></a>00931   }
<a name="l00932"></a>00932 
<a name="l00933"></a><a class="code" href="class_sec_plus_1_1_create_command.html#ac1f3814edaf5a29fd3a89bca85770e0f">00933</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_create_command.html#ac1f3814edaf5a29fd3a89bca85770e0f">project</a>() {
<a name="l00934"></a>00934     $this-&gt;index();
<a name="l00935"></a>00935     $this-&gt;directories();
<a name="l00936"></a>00936     $this-&gt;controller(<span class="stringliteral">&#39;home&#39;</span>);
<a name="l00937"></a>00937     $this-&gt;view(<span class="stringliteral">&#39;home&#39;</span>);
<a name="l00938"></a>00938   }
<a name="l00939"></a>00939 
<a name="l00940"></a><a class="code" href="class_sec_plus_1_1_create_command.html#adbece001d3c0007a273f36b558429bb0">00940</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_create_command.html#adbece001d3c0007a273f36b558429bb0">page</a>($name, $template = NULL) {
<a name="l00941"></a>00941     $this-&gt;controller($name);
<a name="l00942"></a>00942     $this-&gt;view($name, $template);
<a name="l00943"></a>00943   }
<a name="l00944"></a>00944 
<a name="l00945"></a><a class="code" href="class_sec_plus_1_1_create_command.html#ac2c21d89b15f1eee71db586f0fa46143">00945</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_create_command.html#ac2c21d89b15f1eee71db586f0fa46143">createDir</a>($dirname) {
<a name="l00946"></a>00946     <span class="keywordflow">if</span> (file_exists($dirname)) {
<a name="l00947"></a>00947       $this-&gt;print_error(<span class="stringliteral">&quot;file &#39;$dirname&#39; already exists...&quot;</span>);
<a name="l00948"></a>00948       <span class="keywordflow">return</span> FALSE;
<a name="l00949"></a>00949     }
<a name="l00950"></a>00950 
<a name="l00951"></a>00951     <span class="keywordflow">if</span> (mkdir($dirname, 0777, <span class="keyword">true</span>)) {
<a name="l00952"></a>00952       $this-&gt;print_success(<span class="stringliteral">&quot;[CREATED] &quot;</span> . $dirname);
<a name="l00953"></a>00953       <span class="keywordflow">return</span> TRUE;
<a name="l00954"></a>00954     } <span class="keywordflow">else</span> {
<a name="l00955"></a>00955       $this-&gt;print_error(<span class="stringliteral">&quot;[ERROR] &quot;</span> . $dirname);
<a name="l00956"></a>00956       <span class="keywordflow">return</span> FALSE;
<a name="l00957"></a>00957     }
<a name="l00958"></a>00958   }
<a name="l00959"></a>00959 
<a name="l00960"></a><a class="code" href="class_sec_plus_1_1_create_command.html#a6a09508d66a3bd88fa5bde5b157bf13e">00960</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_create_command.html#a6a09508d66a3bd88fa5bde5b157bf13e">directories</a>() {
<a name="l00961"></a>00961     $this-&gt;createDir($this-&gt;config-&gt;getLibDir());
<a name="l00962"></a>00962     $this-&gt;createDir($this-&gt;config-&gt;getControllerDir());
<a name="l00963"></a>00963     $this-&gt;createDir($this-&gt;config-&gt;getViewDir());
<a name="l00964"></a>00964     $this-&gt;createDir($this-&gt;config-&gt;getModelDir());
<a name="l00965"></a>00965     $this-&gt;createDir($this-&gt;config-&gt;getDaoDir());
<a name="l00966"></a>00966     $this-&gt;createDir($this-&gt;config-&gt;getVoDir());    
<a name="l00967"></a>00967   }
<a name="l00968"></a>00968 
<a name="l00969"></a><a class="code" href="class_sec_plus_1_1_create_command.html#aeee32c16aa802d9db2b7abbe6feb16b4">00969</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_create_command.html#aeee32c16aa802d9db2b7abbe6feb16b4">controller</a>($cname) {
<a name="l00970"></a>00970     $controllerName = ucfirst($cname);
<a name="l00971"></a>00971     $control_tpl = dirname($_SERVER[<span class="stringliteral">&#39;SCRIPT_FILENAME&#39;</span>]) . <span class="stringliteral">&#39;/tpl/controller.tpl&#39;</span>;
<a name="l00972"></a>00972 
<a name="l00973"></a>00973     <span class="keywordflow">if</span> (!file_exists($control_tpl)) {
<a name="l00974"></a>00974       $this-&gt;print_error(<span class="stringliteral">&quot;SecPlus-PHP resource file &#39;$control_tpl&#39; not found.\naborting...&quot;</span>);
<a name="l00975"></a>00975       die();
<a name="l00976"></a>00976     }
<a name="l00977"></a>00977 
<a name="l00978"></a>00978     $control_src = file_get_contents($control_tpl);
<a name="l00979"></a>00979 
<a name="l00980"></a>00980     <span class="keywordflow">if</span> (empty($control_src)) {
<a name="l00981"></a>00981       $this-&gt;print_error(<span class="stringliteral">&quot;Permission denied to open &#39;$control_tpl&#39;.&quot;</span>);
<a name="l00982"></a>00982       <span class="keywordflow">return</span>;
<a name="l00983"></a>00983     }
<a name="l00984"></a>00984 
<a name="l00985"></a>00985     $control_src = str_replace(<span class="stringliteral">&quot;{#controller_name#}&quot;</span>, $controllerName, $control_src);
<a name="l00986"></a>00986 
<a name="l00987"></a>00987     $output = $this-&gt;project_dir . <span class="charliteral">&#39;/&#39;</span> . $this-&gt;config-&gt;getControllerDir() . <span class="charliteral">&#39;/&#39;</span> . $controllerName . <span class="stringliteral">&#39;Controller.php&#39;</span>;    
<a name="l00988"></a>00988     
<a name="l00989"></a>00989     <span class="keywordflow">if</span> (!file_put_contents($output, $control_src)) {
<a name="l00990"></a>00990       $this-&gt;print_error(<span class="stringliteral">&quot;[-] Failed to write on file &#39;$output&#39;&quot;</span>);
<a name="l00991"></a>00991       <span class="keywordflow">return</span>;
<a name="l00992"></a>00992     } <span class="keywordflow">else</span> {
<a name="l00993"></a>00993       $this-&gt;print_success(<span class="stringliteral">&quot;Controller &#39;{$controllerName}Controller created with success.&quot;</span>);
<a name="l00994"></a>00994       $this-&gt;print_success(<span class="stringliteral">&quot;Output: $output&quot;</span>);
<a name="l00995"></a>00995     } 
<a name="l00996"></a>00996   }
<a name="l00997"></a>00997 
<a name="l01004"></a><a class="code" href="class_sec_plus_1_1_create_command.html#a010c805861621ee87d8b95737a42a6c5">01004</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_create_command.html#a010c805861621ee87d8b95737a42a6c5">view</a>($name, $tpl_file = NULL) {
<a name="l01005"></a>01005     $viewName = ucfirst($name);
<a name="l01006"></a>01006     $view_tpl = !empty($tpl_file) ? $tpl_file : dirname($_SERVER[<span class="stringliteral">&#39;SCRIPT_FILENAME&#39;</span>]) . <span class="stringliteral">&#39;/tpl/view.tpl&#39;</span>;
<a name="l01007"></a>01007 
<a name="l01008"></a>01008     <span class="keywordflow">if</span> (!file_exists($view_tpl)) {
<a name="l01009"></a>01009       $this-&gt;print_error(<span class="stringliteral">&quot;SecPlus-PHP resource file &#39;$view_tpl&#39; not found.\naborting...&quot;</span>);
<a name="l01010"></a>01010       die();
<a name="l01011"></a>01011     }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013     $view_src = file_get_contents($view_tpl);
<a name="l01014"></a>01014     $view_src = str_replace(<span class="stringliteral">&quot;{#view_name#}&quot;</span>, $viewName, $view_src);
<a name="l01015"></a>01015 
<a name="l01016"></a>01016     <span class="keywordflow">if</span> (empty($view_src)) {
<a name="l01017"></a>01017       $this-&gt;print_error(<span class="stringliteral">&quot;Permission denied to open &#39;$view_tpl&#39;.&quot;</span>);
<a name="l01018"></a>01018       <span class="keywordflow">return</span>;
<a name="l01019"></a>01019     }
<a name="l01020"></a>01020 
<a name="l01021"></a>01021     $output = $this-&gt;project_dir . <span class="charliteral">&#39;/&#39;</span> . $this-&gt;config-&gt;getViewDir() . <span class="charliteral">&#39;/&#39;</span> . $viewName . <span class="stringliteral">&#39;View.php&#39;</span>;
<a name="l01022"></a>01022     
<a name="l01023"></a>01023     <span class="keywordflow">if</span> (!file_put_contents($output, $view_src)) {
<a name="l01024"></a>01024       $this-&gt;print_error(<span class="stringliteral">&quot;Failed to write on file &#39;$output&#39;&quot;</span>);
<a name="l01025"></a>01025       <span class="keywordflow">return</span>;
<a name="l01026"></a>01026     } <span class="keywordflow">else</span> {
<a name="l01027"></a>01027       $this-&gt;print_success(<span class="stringliteral">&quot;View &#39;{$viewName}View created with success.&quot;</span>);
<a name="l01028"></a>01028       $this-&gt;print_success(<span class="stringliteral">&quot;Output: $output&quot;</span>);
<a name="l01029"></a>01029     } 
<a name="l01030"></a>01030   }
<a name="l01031"></a>01031 
<a name="l01032"></a><a class="code" href="class_sec_plus_1_1_create_command.html#a149eb92716c1084a935e04a8d95f7347">01032</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_create_command.html#a149eb92716c1084a935e04a8d95f7347">index</a>() {
<a name="l01033"></a>01033     $index_file = dirname($_SERVER[<span class="stringliteral">&#39;SCRIPT_FILENAME&#39;</span>]) . <span class="stringliteral">&#39;/tpl/index.tpl&#39;</span>;
<a name="l01034"></a>01034     <span class="keywordflow">if</span> (!file_exists($index_file)) {
<a name="l01035"></a>01035       $this-&gt;print_error(<span class="stringliteral">&quot;SecPlus-PHP resource file &#39;$index_file&#39; not found.\naborting...&quot;</span>);
<a name="l01036"></a>01036       die();
<a name="l01037"></a>01037     }
<a name="l01038"></a>01038 
<a name="l01039"></a>01039     $index_src = file_get_contents($index_file);
<a name="l01040"></a>01040     $secplus_path = $_SERVER[<span class="stringliteral">&#39;SCRIPT_FILENAME&#39;</span>];
<a name="l01041"></a>01041     $index_src = str_replace(<span class="stringliteral">&quot;{#secplus_framework_path#}&quot;</span>, $secplus_path, $index_src);
<a name="l01042"></a>01042     $index_src = str_replace(<span class="stringliteral">&quot;{#config_file#}&quot;</span>, $this-&gt;config_file, $index_src);
<a name="l01043"></a>01043 
<a name="l01044"></a>01044     $output = $this-&gt;project_dir . <span class="stringliteral">&#39;/index.php&#39;</span>;
<a name="l01045"></a>01045     <span class="keywordflow">if</span> (!file_put_contents($output, $index_src)) {
<a name="l01046"></a>01046       $this-&gt;print_error(<span class="stringliteral">&quot;Failed to write on file &#39;$output&#39;&quot;</span>);
<a name="l01047"></a>01047       <span class="keywordflow">return</span>;
<a name="l01048"></a>01048     } <span class="keywordflow">else</span> {
<a name="l01049"></a>01049       $this-&gt;print_success(<span class="stringliteral">&quot;Index created with success.&quot;</span>);
<a name="l01050"></a>01050       $this-&gt;print_success(<span class="stringliteral">&quot;Output: $output&quot;</span>);
<a name="l01051"></a>01051     }
<a name="l01052"></a>01052   }
<a name="l01053"></a>01053 
<a name="l01054"></a><a class="code" href="class_sec_plus_1_1_create_command.html#a66791b95523a6f41ae9847d6a1ff5cee">01054</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_create_command.html#a66791b95523a6f41ae9847d6a1ff5cee">dao</a>($name, $tableName = <span class="stringliteral">&quot;&quot;</span>) {
<a name="l01055"></a>01055     <span class="keywordflow">if</span> (empty($name)) {
<a name="l01056"></a>01056       $this-&gt;print_error(<span class="stringliteral">&quot;argument name not supplied.&quot;</span>);
<a name="l01057"></a>01057       $this-&gt;help();
<a name="l01058"></a>01058       <span class="keywordflow">return</span>;
<a name="l01059"></a>01059     }
<a name="l01060"></a>01060     
<a name="l01061"></a>01061     $voName = ucfirst($name);
<a name="l01062"></a>01062     $daoName = $voName . <span class="stringliteral">&#39;DAO&#39;</span>;
<a name="l01063"></a>01063     $dao_src = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01064"></a>01064 
<a name="l01065"></a>01065     $dao_tpl_fname = dirname($_SERVER[<span class="stringliteral">&#39;SCRIPT_FILENAME&#39;</span>]) . <span class="stringliteral">&#39;/tpl/dao.tpl&#39;</span>;
<a name="l01066"></a>01066 
<a name="l01067"></a>01067     <span class="keywordflow">if</span> (!file_exists($dao_tpl_fname)) {
<a name="l01068"></a>01068       $this-&gt;print_error(<span class="stringliteral">&quot;SecPlus-PHP resource file &#39;$dao_tpl_fname&#39; not found.\naborting...&quot;</span>);
<a name="l01069"></a>01069       die();
<a name="l01070"></a>01070     }
<a name="l01071"></a>01071 
<a name="l01072"></a>01072     $dao_tpl_content = file_get_contents($dao_tpl_fname);
<a name="l01073"></a>01073 
<a name="l01074"></a>01074     $dao_src = str_replace(<span class="stringliteral">&quot;{#vo_include#}&quot;</span>,
<a name="l01075"></a>01075                            str_replace($this-&gt;config-&gt;getRootProjectDir() . <span class="charliteral">&#39;/&#39;</span>, <span class="stringliteral">&quot;&quot;</span>, $this-&gt;config-&gt;getVoDir() . <span class="charliteral">&#39;/&#39;</span> . $voName . <span class="stringliteral">&#39;.php&#39;</span>),
<a name="l01076"></a>01076                            $dao_tpl_content);
<a name="l01077"></a>01077 
<a name="l01078"></a>01078     $dao_src = str_replace(<span class="stringliteral">&#39;{#dao_name#}&#39;</span>, $daoName, $dao_src);
<a name="l01079"></a>01079     $dao_src = str_replace(<span class="stringliteral">&#39;{#model_extends#}&#39;</span>, $this-&gt;abstractModelClass, $dao_src);
<a name="l01080"></a>01080     
<a name="l01081"></a>01081     $dao_src = str_replace(<span class="stringliteral">&#39;{#table_name#}&#39;</span>, !empty($tableName) ? <span class="stringliteral">&#39;protected $_tableName = &quot;&#39;</span> . $tableName . <span class="stringliteral">&#39;&quot;;&#39;</span> : <span class="stringliteral">&quot;&quot;</span>, $dao_src);
<a name="l01082"></a>01082     
<a name="l01083"></a>01083     $output = $this-&gt;project_dir . <span class="charliteral">&#39;/&#39;</span> . $this-&gt;config-&gt;getDaoDir() . <span class="charliteral">&#39;/&#39;</span> . $daoName . <span class="stringliteral">&#39;.php&#39;</span>;
<a name="l01084"></a>01084     <span class="keywordflow">if</span> (!file_put_contents($output, $dao_src)) {
<a name="l01085"></a>01085       $this-&gt;print_error(<span class="stringliteral">&quot;[-] Failed to write on file &#39;$output&#39;&quot;</span>);
<a name="l01086"></a>01086       <span class="keywordflow">return</span>;
<a name="l01087"></a>01087     } <span class="keywordflow">else</span> {
<a name="l01088"></a>01088       $this-&gt;print_success(<span class="stringliteral">&quot;[+] DAO &#39;$daoName&#39; created with success.&quot;</span>);
<a name="l01089"></a>01089       $this-&gt;print_success(<span class="stringliteral">&quot;Output: $output&quot;</span>);
<a name="l01090"></a>01090     }
<a name="l01091"></a>01091   }
<a name="l01092"></a>01092 
<a name="l01093"></a><a class="code" href="class_sec_plus_1_1_create_command.html#aa311520cb1317f7ebec57bb59366b385">01093</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_create_command.html#aa311520cb1317f7ebec57bb59366b385">valueobject</a>($vo_name) {
<a name="l01094"></a>01094     $vo_name = ucfirst($vo_name);
<a name="l01095"></a>01095     $vo_tpl_fname = dirname($_SERVER[<span class="stringliteral">&#39;SCRIPT_FILENAME&#39;</span>]) . <span class="stringliteral">&#39;/tpl/vo.tpl&#39;</span>;
<a name="l01096"></a>01096     $vo_src = file_get_contents($vo_tpl_fname);
<a name="l01097"></a>01097     <span class="keywordflow">if</span> (empty($vo_src)) {
<a name="l01098"></a>01098       $this-&gt;print_error(<span class="stringliteral">&quot;Failed to open the SecPlus-PHP resource file &#39;$vo_tpl_fname&#39;.&quot;</span>);
<a name="l01099"></a>01099       <span class="keywordflow">return</span>;
<a name="l01100"></a>01100     }
<a name="l01101"></a>01101     $vo_src = str_replace(<span class="stringliteral">&quot;{#value_object#}&quot;</span>, $vo_name, $vo_src);
<a name="l01102"></a>01102     $output = $this-&gt;project_dir . <span class="charliteral">&#39;/&#39;</span> . $this-&gt;config-&gt;getVoDir() . <span class="charliteral">&#39;/&#39;</span> . $vo_name . <span class="stringliteral">&#39;.php&#39;</span>;    
<a name="l01103"></a>01103 
<a name="l01104"></a>01104     <span class="keywordflow">if</span> (!file_put_contents($output, $vo_src)) {
<a name="l01105"></a>01105       $this-&gt;print_error(<span class="stringliteral">&quot;[-] Failed to write on file &#39;$output&#39;&quot;</span>);
<a name="l01106"></a>01106       <span class="keywordflow">return</span>;
<a name="l01107"></a>01107     } <span class="keywordflow">else</span> {
<a name="l01108"></a>01108       $this-&gt;print_success(<span class="stringliteral">&quot;[+] ValueObject &#39;$vo_name&#39; created with success.&quot;</span>);
<a name="l01109"></a>01109       $this-&gt;print_success(<span class="stringliteral">&quot;Output: $output&quot;</span>);
<a name="l01110"></a>01110     }
<a name="l01111"></a>01111   }
<a name="l01112"></a>01112 
<a name="l01113"></a><a class="code" href="class_sec_plus_1_1_create_command.html#a85efae42db767b340ce4564b48733a49">01113</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_create_command.html#a85efae42db767b340ce4564b48733a49">configfile</a>($config_file = <span class="stringliteral">&#39;config.php&#39;</span>) {
<a name="l01114"></a>01114     $conf_tpl_fname = dirname($_SERVER[<span class="stringliteral">&#39;SCRIPT_FILENAME&#39;</span>]) . <span class="stringliteral">&#39;/tpl/configfile.tpl&#39;</span>;
<a name="l01115"></a>01115     $conf_src = file_get_contents($conf_tpl_fname);
<a name="l01116"></a>01116 
<a name="l01117"></a>01117     <span class="keywordflow">if</span> (empty($conf_src)) {
<a name="l01118"></a>01118       print(<span class="stringliteral">&quot;[-] Failed to open SecPlus-PHP resource file &#39;{$conf_tpl_fname}&#39;.\n&quot;</span>);
<a name="l01119"></a>01119       <span class="keywordflow">return</span> FALSE;
<a name="l01120"></a>01120     }
<a name="l01121"></a>01121 
<a name="l01122"></a>01122     $output = $config_file;
<a name="l01123"></a>01123 
<a name="l01124"></a>01124     <span class="keywordflow">if</span> (!file_put_contents($output, $conf_src)) {
<a name="l01125"></a>01125       $this-&gt;print_error(<span class="stringliteral">&quot;[-] Failed to write on file &#39;$output&#39;\n&quot;</span>);
<a name="l01126"></a>01126       <span class="keywordflow">return</span> FALSE;
<a name="l01127"></a>01127     } <span class="keywordflow">else</span> {
<a name="l01128"></a>01128       print(<span class="stringliteral">&quot;[+] Config file &#39;$config_file&#39; created with success.\n&quot;</span>);
<a name="l01129"></a>01129       print(<span class="stringliteral">&quot;[+] Output: $output\n&quot;</span>);
<a name="l01130"></a>01130       <span class="keywordflow">return</span> TRUE;
<a name="l01131"></a>01131     }
<a name="l01132"></a>01132   }
<a name="l01133"></a>01133 
<a name="l01134"></a><a class="code" href="class_sec_plus_1_1_create_command.html#a7627fda489c1ddf2fa0d594607dc058f">01134</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_create_command.html#a7627fda489c1ddf2fa0d594607dc058f">vo</a>($vo_name) {
<a name="l01135"></a>01135     $this-&gt;valueobject($vo_name);
<a name="l01136"></a>01136   }
<a name="l01137"></a>01137 }
<a name="l01138"></a>01138 
<a name="l01139"></a><a class="code" href="class_sec_plus_1_1_exit_command.html">01139</a> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_exit_command.html">ExitCommand</a> <span class="keyword">extends</span> <a class="code" href="class_sec_plus_1_1_shell_cmd.html">ShellCmd</a> {
<a name="l01140"></a><a class="code" href="class_sec_plus_1_1_exit_command.html#a91482c4db18186b33acbaf1528a50ddc">01140</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_exit_command.html#a91482c4db18186b33acbaf1528a50ddc">help</a>() {}
<a name="l01141"></a><a class="code" href="class_sec_plus_1_1_exit_command.html#a999491405b08d7cd92d311fb3453be9d">01141</a>   <span class="keyword">public</span> function <span class="keyword">auto</span>() {
<a name="l01142"></a>01142     $this-&gt;print_success(<span class="stringliteral">&quot;Exiting...&quot;</span>);
<a name="l01143"></a>01143     <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;readline_write_history&#39;</span>)) {
<a name="l01144"></a>01144       $history = dirname($_SERVER[<span class="stringliteral">&#39;SCRIPT_FILENAME&#39;</span>]) . <span class="stringliteral">&#39;/.secplus_history&#39;</span>;
<a name="l01145"></a>01145       readline_write_history($history);
<a name="l01146"></a>01146     }
<a name="l01147"></a>01147 
<a name="l01148"></a>01148     exit(0);
<a name="l01149"></a>01149   }
<a name="l01150"></a>01150 }
<a name="l01151"></a>01151 
<a name="l01152"></a><a class="code" href="class_sec_plus_1_1_shell.html">01152</a> <span class="keyword">class </span><a class="code" href="class_sec_plus_1_1_shell.html">Shell</a> {
<a name="l01153"></a><a class="code" href="class_sec_plus_1_1_shell.html#aa58105470d0307085c38e19ee0a97975">01153</a>   <span class="keyword">const</span> prompt = <span class="stringliteral">&quot;SEC+&gt; &quot;</span>;
<a name="l01154"></a><a class="code" href="class_sec_plus_1_1_shell.html#a49c7011be9c979d9174c52a8b83e5d8e">01154</a>   <span class="keyword">protected</span> <a class="code" href="class_sec_plus_1_1_shell.html#a49c7011be9c979d9174c52a8b83e5d8e">$config</a>;
<a name="l01155"></a><a class="code" href="class_sec_plus_1_1_shell.html#ae6059ea82d657151d1d5b4f5c5ef9177">01155</a>   <span class="keyword">protected</span> $config_file = <span class="stringliteral">&#39;config.php&#39;</span>;
<a name="l01156"></a>01156 
<a name="l01157"></a><a class="code" href="class_sec_plus_1_1_shell.html#af088c93ce27768e9478939b542e02981">01157</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_shell.html#af088c93ce27768e9478939b542e02981">__construct</a>($config_file) {
<a name="l01158"></a>01158     $this-&gt;config_file = $config_file;
<a name="l01159"></a>01159     $this-&gt;banner();
<a name="l01160"></a>01160     $this-&gt;checkConfig();
<a name="l01161"></a>01161   }
<a name="l01162"></a>01162 
<a name="l01163"></a><a class="code" href="class_sec_plus_1_1_shell.html#a859cdb2c62ae762416b9967ea7a0633f">01163</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_shell.html#a859cdb2c62ae762416b9967ea7a0633f">checkConfig</a>() {
<a name="l01164"></a>01164     <span class="keywordflow">if</span> (file_exists($this-&gt;config_file)) {
<a name="l01165"></a>01165       require $this-&gt;config_file;
<a name="l01166"></a>01166       <span class="keywordflow">if</span> (class_exists(<span class="stringliteral">&#39;\Config&#39;</span>)) {
<a name="l01167"></a>01167         $this-&gt;config = \Config::getInstance();
<a name="l01168"></a>01168         print <span class="stringliteral">&quot;[+] using &#39;{$this-&gt;config_file}&#39; for configuration.\n&quot;</span>;
<a name="l01169"></a>01169       }
<a name="l01170"></a>01170     } <span class="keywordflow">else</span> {
<a name="l01171"></a>01171       print <span class="stringliteral">&quot;[-] file &#39;{$this-&gt;config_file}&#39; not exists or permission denied to open.\n&quot;</span>;
<a name="l01172"></a>01172       print <span class="stringliteral">&quot;[-] we need a configuration file to run scaffolding commands.\n&quot;</span>;
<a name="l01173"></a>01173       print <span class="stringliteral">&quot;[?] You want that we generate the &#39;{$this-&gt;config_file}&#39; for you? [y/N] &quot;</span>;
<a name="l01174"></a>01174       $opt = Shell::readInput(<span class="keyword">false</span>);
<a name="l01175"></a>01175       <span class="keywordflow">if</span> (empty($opt)||($opt != <span class="stringliteral">&quot;y&quot;</span> &amp;&amp; $opt != <span class="stringliteral">&quot;Y&quot;</span>)) {
<a name="l01176"></a>01176         print <span class="stringliteral">&quot;[-] aborting...\n&quot;</span>;
<a name="l01177"></a>01177         die();
<a name="l01178"></a>01178       } <span class="keywordflow">else</span> {
<a name="l01179"></a>01179         <span class="keywordflow">if</span> ($this-&gt;generateConfig($this-&gt;config_file)) {
<a name="l01180"></a>01180           $this-&gt;checkConfig();
<a name="l01181"></a>01181         } <span class="keywordflow">else</span> {
<a name="l01182"></a>01182           die();
<a name="l01183"></a>01183         }
<a name="l01184"></a>01184       }      
<a name="l01185"></a>01185     }
<a name="l01186"></a>01186   }
<a name="l01187"></a>01187 
<a name="l01188"></a><a class="code" href="class_sec_plus_1_1_shell.html#af8dcb49b25f712fdb5a54180db6f65aa">01188</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_shell.html#af8dcb49b25f712fdb5a54180db6f65aa">generateConfig</a>($config_file) {
<a name="l01189"></a>01189     <span class="keywordflow">return</span> CreateCommand::configfile($config_file);
<a name="l01190"></a>01190   }
<a name="l01191"></a>01191 
<a name="l01192"></a><a class="code" href="class_sec_plus_1_1_shell.html#aeaeb60ae9f001fe9766fe94733babc5f">01192</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_shell.html#aeaeb60ae9f001fe9766fe94733babc5f">loopExecute</a>() {
<a name="l01193"></a>01193     <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;readline_read_history&#39;</span>)) {
<a name="l01194"></a>01194       readline_read_history(dirname($_SERVER[<span class="stringliteral">&#39;SCRIPT_FILENAME&#39;</span>]) . <span class="stringliteral">&#39;/.secplus_history&#39;</span>);
<a name="l01195"></a>01195     }
<a name="l01196"></a>01196 
<a name="l01197"></a>01197     <span class="keywordflow">while</span>(1) {
<a name="l01198"></a>01198       $command = Shell::readInput();
<a name="l01199"></a>01199       $this-&gt;execute($command);
<a name="l01200"></a>01200     }
<a name="l01201"></a>01201   }
<a name="l01202"></a>01202 
<a name="l01203"></a><a class="code" href="class_sec_plus_1_1_shell.html#aa9a85e2458f0594bf3962952436c2849">01203</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_shell.html#aa9a85e2458f0594bf3962952436c2849">readInput</a>($with_prompt = <span class="keyword">true</span>) {
<a name="l01204"></a>01204     $str = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01205"></a>01205     <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&quot;readline&quot;</span>)) {
<a name="l01206"></a>01206       $str = readline($with_prompt == <span class="keyword">true</span> ? Shell::prompt : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01207"></a>01207       readline_add_history($str);
<a name="l01208"></a>01208     } <span class="keywordflow">else</span> {
<a name="l01209"></a>01209       print Shell::prompt;
<a name="l01210"></a>01210       $str = str_replace(array(<span class="stringliteral">&quot;\r&quot;</span>,<span class="stringliteral">&quot;\n&quot;</span>), null, fread(STDIN, 1024));
<a name="l01211"></a>01211     }
<a name="l01212"></a>01212 
<a name="l01213"></a>01213     <span class="keywordflow">return</span> $str;
<a name="l01214"></a>01214   }
<a name="l01215"></a>01215 
<a name="l01216"></a><a class="code" href="class_sec_plus_1_1_shell.html#a5704439633de497abe437bb32a0d8de1">01216</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_shell.html#a5704439633de497abe437bb32a0d8de1">execute</a>($command) {
<a name="l01217"></a>01217     <span class="comment">/* readline returns FALSE for CTRL+D */</span>
<a name="l01218"></a>01218     <span class="keywordflow">if</span> ($command == FALSE) {
<a name="l01219"></a>01219       print <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01220"></a>01220       $exit = <span class="keyword">new</span> <a class="code" href="class_sec_plus_1_1_exit_command.html">ExitCommand</a>();
<a name="l01221"></a>01221       $exit-&gt;auto();
<a name="l01222"></a>01222       <span class="keywordflow">return</span>;
<a name="l01223"></a>01223     }
<a name="l01224"></a>01224     
<a name="l01225"></a>01225     $params = explode(<span class="stringliteral">&quot; &quot;</span>, $command);
<a name="l01226"></a>01226     
<a name="l01227"></a>01227     $classname = __NAMESPACE__ . <span class="charliteral">&#39;\\&#39;</span> . $params[0] . <span class="stringliteral">&#39;Command&#39;</span>;
<a name="l01228"></a>01228     $main_command = $params[0];
<a name="l01229"></a>01229     $action = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01230"></a>01230     $p = array();
<a name="l01231"></a>01231 
<a name="l01232"></a>01232     <span class="keywordflow">if</span> (count($params) &gt; 1) {
<a name="l01233"></a>01233       $action = $params[1];
<a name="l01234"></a>01234     } <span class="keywordflow">else</span> {
<a name="l01235"></a>01235       <span class="comment">/* for commands that does not have a action. eg. help */</span>
<a name="l01236"></a>01236       $action = <span class="stringliteral">&quot;auto&quot;</span>;
<a name="l01237"></a>01237     }
<a name="l01238"></a>01238 
<a name="l01239"></a>01239     <span class="keywordflow">if</span> (count($params) &gt; 2) {
<a name="l01240"></a>01240       $p = array_slice($params, 2);
<a name="l01241"></a>01241     }
<a name="l01242"></a>01242 
<a name="l01243"></a>01243     <span class="keywordflow">if</span> (!class_exists($classname)) {
<a name="l01244"></a>01244       print <span class="stringliteral">&quot;error: command &#39;$main_command&#39; not found.\n&quot;</span>;
<a name="l01245"></a>01245       print <span class="stringliteral">&quot;type &#39;help&#39; for a list of commands available.\n&quot;</span>;
<a name="l01246"></a>01246       <span class="keywordflow">return</span>;
<a name="l01247"></a>01247     }
<a name="l01248"></a>01248     
<a name="l01249"></a>01249     $class = <span class="keyword">new</span> $classname($this-&gt;config, dirname($this-&gt;config_file));
<a name="l01250"></a>01250     $class-&gt;setConfigFile($this-&gt;config_file);
<a name="l01251"></a>01251 
<a name="l01252"></a>01252     <span class="keywordflow">if</span> (!method_exists($class, $action)) {      
<a name="l01253"></a>01253       print <span class="stringliteral">&quot;[-] error: command &#39;$main_command&#39; does not have a action &#39;$action&#39;.\n&quot;</span>;
<a name="l01254"></a>01254       print <span class="stringliteral">&quot;[+] for help, type: $main_command help.\n&quot;</span>;
<a name="l01255"></a>01255       <span class="keywordflow">return</span>;
<a name="l01256"></a>01256     }
<a name="l01257"></a>01257     call_user_func_array(array($class, $action), $p);
<a name="l01258"></a>01258   }
<a name="l01259"></a>01259 
<a name="l01260"></a><a class="code" href="class_sec_plus_1_1_shell.html#a71c184af60e335ef57f5840abb5315d6">01260</a>   <span class="keyword">public</span> function <a class="code" href="class_sec_plus_1_1_shell.html#a71c184af60e335ef57f5840abb5315d6">banner</a>() {
<a name="l01261"></a>01261     $b = <span class="stringliteral">&quot;SEC+ Security WebFramework\nLicense:\tGNU GPL v2.0\nAuthor:\tTiago Natel de Moura aka i4k &lt;tiago4orion@gmail.com&gt;\n&quot;</span>;
<a name="l01262"></a>01262     $b .= php_uname() . <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01263"></a>01263     print($b);
<a name="l01264"></a>01264   }
<a name="l01265"></a>01265 
<a name="l01266"></a><a class="code" href="class_sec_plus_1_1_shell.html#acfb9193d68abf909ca80dbe45d53b9a1">01266</a>   <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_sec_plus_1_1_shell.html#acfb9193d68abf909ca80dbe45d53b9a1">write</a>($str) {
<a name="l01267"></a>01267     fwrite(STDOUT, $str, strlen($str));
<a name="l01268"></a>01268   }
<a name="l01269"></a>01269 }
<a name="l01270"></a>01270 
<a name="l01271"></a>01271 <span class="keywordflow">if</span> (php_sapi_name() == <span class="stringliteral">&quot;cli&quot;</span>) {
<a name="l01272"></a>01272   <a class="code" href="namespace_sec_plus.html#a7356029118fb0aea3f29fedd5a529938">secplus_cmd</a>();
<a name="l01273"></a>01273  }
<a name="l01274"></a>01274 
<a name="l01275"></a><a class="code" href="namespace_sec_plus.html#a7356029118fb0aea3f29fedd5a529938">01275</a> function <a class="code" href="namespace_sec_plus.html#a7356029118fb0aea3f29fedd5a529938">secplus_cmd</a>() {
<a name="l01276"></a>01276   global $argc;
<a name="l01277"></a>01277   global $argv;
<a name="l01278"></a>01278   $config_file = <span class="stringliteral">&#39;config.php&#39;</span>;
<a name="l01279"></a>01279 
<a name="l01280"></a>01280   <span class="keywordflow">for</span> ($i = 0; $i &lt; $argc; $i++) {
<a name="l01281"></a>01281     <span class="keywordflow">if</span> ($argv[$i] == <span class="stringliteral">&quot;-c&quot;</span>) {
<a name="l01282"></a>01282       <span class="keywordflow">if</span> ($i &lt; ($argc - 1)) {
<a name="l01283"></a>01283         $config_file = $argv[$i+1];
<a name="l01284"></a>01284       }
<a name="l01285"></a>01285     }
<a name="l01286"></a>01286   }
<a name="l01287"></a>01287   
<a name="l01288"></a>01288   $secshell = <span class="keyword">new</span> <a class="code" href="class_sec_plus_1_1_shell.html">Shell</a>($config_file);
<a name="l01289"></a>01289   $secshell-&gt;loopExecute();
<a name="l01290"></a>01290 }
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="secplus_8lib_8php.html">secplus.lib.php</a>      </li>
      <li class="footer">Generated on Sat Jul 21 2012 23:37:45 for SecPlus-PHP Web Framework by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
